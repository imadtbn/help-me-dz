<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุณุงุนุฏูู - ุฏููู ุงููุคุณุณุงุช ุงููุญููุฉ ูู ุงูุฌุฒุงุฆุฑ</title>

    <!-- Meta tags for SEO -->
    <meta name="description" content="ุฏููู ุดุงูู ููุจุญุซ ุนู ุงููุณุชุดููุงุชุ ุงูุตูุฏููุงุชุ ุงูุนูุงุฏุงุชุ ูุงูุฃุทุจุงุก ูู ุงูุฌุฒุงุฆุฑ">
    <meta name="keywords" content="ุฏููู ุทุจู, ูุณุชุดููุงุช ุงูุฌุฒุงุฆุฑ, ุตูุฏููุงุช, ุฃุทุจุงุก, ุนูุงุฏุงุช, ุฎุฏูุงุช ุทุจูุฉ">
    <meta name="author" content="ุณุงุนุฏูู">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="ุณุงุนุฏูู - ุฏููู ุงููุคุณุณุงุช ุงููุญููุฉ ูู ุงูุฌุฒุงุฆุฑ">
    <meta property="og:description" content="ุงุจุญุซ ุนู ุงููุคุณุณุงุช ุงูุทุจูุฉ ูุงูุฎุฏููุฉ ูู ูุฏููุชู">
    <meta property="og:type" content="website">
    <meta property="og:locale" content="ar_DZ">

    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800&display=swap" rel="stylesheet">

    <!-- Stylesheets -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/map-styles.css">
    <link rel="stylesheet" href="css/responsive.css">

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">

    <!-- PWA Support -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4361ee">


    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />

</head>

<body>
    <!-- ุดุฑูุท ุงูุชููู ุงูุนููู -->
    <header class="header" id="main-header">
        <div class="container">
            <nav class="navbar" role="navigation" aria-label="ุงููุงุฆูุฉ ุงูุฑุฆูุณูุฉ">
                <div class="logo">
                    <a href="index.html" aria-label="ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ - ุณุงุนุฏูู">
                        <i class="fas fa-hands-helping" aria-hidden="true"></i>
                        <span>ุณุงุนุฏูู</span>
                    </a>
                </div>

                <div class="nav-links" id="main-nav">
                    <a href="index.html" class="active" aria-current="page">
                        <i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ
                    </a>
                    <a href="search.html">
                        <i class="fas fa-search"></i> ุจุญุซ ูุชูุฏู
                    </a>
                    <a href="categories.html">
                        <i class="fas fa-list"></i> ุงููุฆุงุช
                    </a>
                    <a href="add-business.html">
                        <i class="fas fa-plus-circle"></i> ุฃุถู ูุคุณุณุฉ
                    </a>
                    <a href="about.html">
                        <i class="fas fa-info-circle"></i> ุนูุง
                    </a>
                </div>

                <button class="mobile-menu-btn" id="mobile-menu-toggle" aria-label="ูุชุญ ุงููุงุฆูุฉ" aria-expanded="false">
                    <i class="fas fa-bars"></i>
                </button>
            </nav>
        </div>
    </header>

    <!-- ูุณู ุงูุจุทู -->
    <section class="hero" role="banner">
        <div class="container">
            <div class="hero-content">
                <h1 class="hero-title">ุงุจุญุซ ุนู ุงููุคุณุณุงุช ูุงูุฎุฏูุงุช ูู ุงูุฌุฒุงุฆุฑ</h1>
                <p class="hero-subtitle">ุฏูููู ุงูุดุงูู ููุนุซูุฑ ุนูู ุงููุณุชุดููุงุชุ ุงูุนูุงุฏุงุชุ ุงูุตูุฏููุงุช ูุงููุคุณุณุงุช ุงูุฎุฏููุฉ ูู
                    ุฌููุน ูุฏู ุงูุฌุฒุงุฆุฑ</p>

                <!-- ุดุฑูุท ุงูุจุญุซ -->
                <div class="search-box" role="search">
                    <form class="search-form" id="search-form" role="search">
                        <div class="search-input-group">
                            <i class="fas fa-search search-icon" aria-hidden="true"></i>
                            <input type="search" id="main-search" class="search-input"
                                placeholder="ูุงุฐุง ุชุจุญุซ ุนูุ (ุงุณู ุงููุคุณุณุฉุ ุทุจูุจุ ุฎุฏูุฉ...)"
                                aria-label="ุจุญุซ ุนู ูุคุณุณุฉ ุฃู ุฎุฏูุฉ">
                        </div>

                        <div class="search-input-group">
                            <i class="fas fa-map-marker-alt search-icon" aria-hidden="true"></i>
                            <input type="text" id="location-search" class="search-input"
                                placeholder="ุงููุฏููุฉ ุฃู ุงูููุทูุฉ" aria-label="ุงููุฏููุฉ ุฃู ุงูููุทูุฉ" list="algerian-cities">
                            <datalist id="algerian-cities">
                                <!-- ุณูุชู ููุคูุง ุจูุงุณุทุฉ JavaScript -->
                            </datalist>
                        </div>

                        <select id="category-select" class="category-select" aria-label="ุงุฎุชุฑ ุงููุฆุฉ">
                            <option value="">ุฌููุน ุงููุฆุงุช</option>
                            <option value="hospital">ูุณุชุดููุงุช</option>
                            <option value="clinic">ุนูุงุฏุงุช</option>
                            <option value="pharmacy">ุตูุฏููุงุช</option>
                            <option value="doctor">ุฃุทุจุงุก</option>
                            <option value="dentist">ุฃุทุจุงุก ุฃุณูุงู</option>
                            <option value="laboratory">ูุฎุชุจุฑุงุช</option>
                            <option value="association">ุฌูุนูุงุช</option>
                        </select>

                        <button type="submit" id="search-btn" class="search-btn" aria-label="ุจุญุซ">
                            <i class="fas fa-search" aria-hidden="true"></i> ุจุญุซ
                        </button>
                    </form>

                    <!-- ูุฆุงุช ุณุฑูุนุฉ -->
                    <div class="quick-categories" aria-label="ูุฆุงุช ุณุฑูุนุฉ">
                        <h3>ุชุตูุญ ุญุณุจ ุงููุฆุฉ:</h3>
                        <div class="categories-grid">
                            <a href="category.html?cat=hospital" class="category-card">
                                <div class="category-icon" aria-hidden="true">
                                    <i class="fas fa-hospital"></i>
                                </div>
                                <span>ูุณุชุดููุงุช</span>
                            </a>

                            <a href="category.html?cat=clinic" class="category-card">
                                <div class="category-icon" aria-hidden="true">
                                    <i class="fas fa-clinic-medical"></i>
                                </div>
                                <span>ุนูุงุฏุงุช</span>
                            </a>

                            <a href="category.html?cat=pharmacy" class="category-card">
                                <div class="category-icon" aria-hidden="true">
                                    <i class="fas fa-prescription-bottle-alt"></i>
                                </div>
                                <span>ุตูุฏููุงุช</span>
                            </a>

                            <a href="category.html?cat=doctor" class="category-card">
                                <div class="category-icon" aria-hidden="true">
                                    <i class="fas fa-user-md"></i>
                                </div>
                                <span>ุฃุทุจุงุก</span>
                            </a>

                            <a href="category.html?cat=dentist" class="category-card">
                                <div class="category-icon" aria-hidden="true">
                                    <i class="fas fa-tooth"></i>
                                </div>
                                <span>ุฃุณูุงู</span>
                            </a>

                            <a href="category.html?cat=laboratory" class="category-card">
                                <div class="category-icon" aria-hidden="true">
                                    <i class="fas fa-flask"></i>
                                </div>
                                <span>ูุฎุชุจุฑุงุช</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ุงููุญุชูู ุงูุฑุฆูุณู -->
    <main class="main-content" id="main-content">
        <div class="container">
            <div class="content-wrapper">
                <!-- ูุณู ุงูุฎุฑูุทุฉ -->
                <section class="map-section" aria-labelledby="map-title">
                    <div class="section-header">
                        <h2 id="map-title"><i class="fas fa-map-marked-alt"></i> ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ</h2>
                        <button id="locate-me" class="btn-secondary" aria-label="ุชุญุฏูุฏ ูููุนู ุงูุญุงูู">
                            <i class="fas fa-location-arrow"></i> ุชุญุฏูุฏ ูููุนู
                        </button>
                    </div>

                    <div id="map" class="interactive-map" aria-label="ุฎุฑูุทุฉ ุชูุงุนููุฉ ูููุคุณุณุงุช" role="application"
                        tabindex="0"></div>

                    <div class="map-controls" aria-label="ุชุญููุงุช ุงูุฎุฑูุทุฉ">
                        <button id="zoom-in" class="map-control-btn" aria-label="ุชูุจูุฑ ุงูุฎุฑูุทุฉ">
                            <i class="fas fa-plus"></i>
                        </button>
                        <button id="zoom-out" class="map-control-btn" aria-label="ุชุตุบูุฑ ุงูุฎุฑูุทุฉ">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button id="fullscreen-map" class="map-control-btn" aria-label="ุนุฑุถ ุงูุฎุฑูุทุฉ ุจูุงูู ุงูุดุงุดุฉ">
                            <i class="fas fa-expand"></i>
                        </button>
                    </div>
                </section>

                <!-- ูุชุงุฆุฌ ุงูุจุญุซ -->
                <section class="results-section" aria-labelledby="results-title">
                    <div class="section-header">
                        <h2 id="results-title"><i class="fas fa-search"></i> ูุชุงุฆุฌ ุงูุจุญุซ</h2>
                        <div class="results-count">ุนูุฑุถ <span id="results-count">0</span> ูุชูุฌุฉ</div>
                    </div>

                    <div class="filters" aria-label="ุฎูุงุฑุงุช ุงูุชุตููุฉ">
                        <select id="sort-select" class="filter-select" aria-label="ุชุฑุชูุจ ุงููุชุงุฆุฌ">
                            <option value="distance">ุงูุฃูุฑุจ ุฃููุงู</option>
                            <option value="rating">ุงูุฃุนูู ุชููููุงู</option>
                            <option value="name">ุงูุงุณู (ุฃ-ู)</option>
                            <option value="reviewCount">ุงูุฃูุซุฑ ุชููููุงู</option>
                        </select>

                        <select id="radius-select" class="filter-select" aria-label="ูุทุงู ุงูุจุญุซ">
                            <option value="2">ูุทุงู 2 ูู</option>
                            <option value="5" selected>ูุทุงู 5 ูู</option>
                            <option value="10">ูุทุงู 10 ูู</option>
                            <option value="20">ูุทุงู 20 ูู</option>
                        </select>

                        <button id="clear-filters" class="btn-secondary" aria-label="ุฅุนุงุฏุฉ ุชุนููู ุงูููุงุชุฑ">
                            <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุชุนููู
                        </button>
                    </div>

                    <div id="business-results" class="business-results" aria-live="polite" aria-atomic="true">
                        <!-- ุณูุชู ููุคูุง ุจูุงุณุทุฉ JavaScript -->
                        <div class="initial-message">
                            <i class="fas fa-search" aria-hidden="true"></i>
                            <p>ุงุจุฏุฃ ุจุงูุจุญุซ ุนู ุงููุคุณุณุงุช ูู ูุฏููุชู</p>
                        </div>
                    </div>

                    <!-- ุชุญููู ุงููุฒูุฏ -->
                    <div class="load-more-container" id="load-more-container" style="display: none;">
                        <button id="load-more-btn" class="load-more-btn">
                            <i class="fas fa-arrow-down"></i> ุชุญููู ุงููุฒูุฏ
                        </button>
                    </div>
                </section>
            </div>


            <!-- ุงููุคุณุณุงุช ุงููููุฒุฉ -->
            <section class="featured-section" aria-labelledby="featured-title">
                <div class="section-header">
                    <h2 id="featured-title"><i class="fas fa-star"></i> ูุคุณุณุงุช ูููุฒุฉ</h2>
                    <a href="featured.html" class="view-all" aria-label="ุนุฑุถ ุฌููุน ุงููุคุณุณุงุช ุงููููุฒุฉ">
                        ุนุฑุถ ุงููู <i class="fas fa-arrow-left"></i>
                    </a>
                </div>

                <div class="featured-grid" id="featured-grid">
                    <!-- ุณูุชู ููุคูุง ุจูุงุณุทุฉ JavaScript -->
                    <div class="loading-featured">
                        <div class="spinner small"></div>
                    </div>
                </div>
            </section>

            <!-- ูุณู ุงูุฅุญุตุงุฆูุงุช  -->
            <section class="stats-section" aria-labelledby="stats-title">
                <div class="container">
                    <div class="section-header">
                        <h2 id="stats-title">
                            <i class="fas fa-chart-line"></i> ุฅุญุตุงุฆูุงุช ุญูุฉ
                            <span class="stats-subtitle">ุชุญุฏูุซ ุชููุงุฆู ูู 30 ุซุงููุฉ</span>
                        </h2>
                        <div class="stats-update-time">
                            <i class="fas fa-sync-alt"></i>
                            <span id="last-update">ุขุฎุฑ ุชุญุฏูุซ: ุงูุขู</span>
                        </div>
                    </div>

                    <div class="stats-grid">
                        <!-- ูุณุชุดููุงุช -->
                        <div class="stat-card" data-category="hospital">
                            <div class="stat-indicator"></div>
                            <div class="stat-icon">
                                <i class="fas fa-hospital"></i>
                            </div>
                            <div class="stat-number" id="hospital-count">0</div>
                            <div class="stat-label">ูุณุชุดูู</div>
                            <div class="stat-trend">
                                <i class="fas fa-arrow-up trend-up"></i>
                                <span class="trend-value">+12%</span>
                            </div>
                            <div class="stat-progress">
                                <svg class="progress-ring" width="40" height="40">
                                    <circle class="progress-ring-circle" stroke-width="4" fill="transparent" r="16"
                                        cx="20" cy="20" />
                                </svg>
                            </div>
                        </div>

                        <!-- ุนูุงุฏุงุช -->
                        <div class="stat-card" data-category="clinic">
                            <div class="stat-indicator"></div>
                            <div class="stat-icon">
                                <i class="fas fa-clinic-medical"></i>
                            </div>
                            <div class="stat-number" id="clinic-count">0</div>
                            <div class="stat-label">ุนูุงุฏุฉ</div>
                            <div class="stat-trend">
                                <i class="fas fa-arrow-up trend-up"></i>
                                <span class="trend-value">+8%</span>
                            </div>
                            <div class="stat-progress">
                                <svg class="progress-ring" width="40" height="40">
                                    <circle class="progress-ring-circle" stroke-width="4" fill="transparent" r="16"
                                        cx="20" cy="20" />
                                </svg>
                            </div>
                        </div>

                        <!-- ุตูุฏููุงุช -->
                        <div class="stat-card" data-category="pharmacy">
                            <div class="stat-indicator"></div>
                            <div class="stat-icon">
                                <i class="fas fa-prescription-bottle-alt"></i>
                            </div>
                            <div class="stat-number" id="pharmacy-count">0</div>
                            <div class="stat-label">ุตูุฏููุฉ</div>
                            <div class="stat-trend">
                                <i class="fas fa-arrow-up trend-up"></i>
                                <span class="trend-value">+15%</span>
                            </div>
                            <div class="stat-progress">
                                <svg class="progress-ring" width="40" height="40">
                                    <circle class="progress-ring-circle" stroke-width="4" fill="transparent" r="16"
                                        cx="20" cy="20" />
                                </svg>
                            </div>
                        </div>

                        <!-- ุฃุทุจุงุก -->
                        <div class="stat-card" data-category="doctor">
                            <div class="stat-indicator"></div>
                            <div class="stat-icon">
                                <i class="fas fa-user-md"></i>
                            </div>
                            <div class="stat-number" id="doctor-count">0</div>
                            <div class="stat-label">ุทุจูุจ</div>
                            <div class="stat-trend">
                                <i class="fas fa-arrow-up trend-up"></i>
                                <span class="trend-value">+5%</span>
                            </div>
                            <div class="stat-progress">
                                <svg class="progress-ring" width="40" height="40">
                                    <circle class="progress-ring-circle" stroke-width="4" fill="transparent" r="16"
                                        cx="20" cy="20" />
                                </svg>
                            </div>
                        </div>
                    </div>

                    <!-- ุฅุญุตุงุฆูุงุช ุฅุถุงููุฉ -->
                    <div class="additional-stats" id="additional-stats">
                        <div class="additional-stat">
                            <div class="stat-value">0</div>
                            <div class="stat-description">ูุคุณุณุฉ ูููุฒุฉ</div>
                        </div>
                        <div class="additional-stat">
                            <div class="stat-value">0</div>
                            <div class="stat-description">ูุฏููุฉ ูุบุทุงุฉ</div>
                        </div>
                        <div class="additional-stat">
                            <div class="stat-value">0</div>
                            <div class="stat-description">ุชูููู ููุฏู</div>
                        </div>
                        <div class="additional-stat">
                            <div class="stat-value">0.0</div>
                            <div class="stat-description">ูุชูุณุท ุงูุชูููู</div>
                        </div>
                    </div>

                    <!-- ุฒุฑ ุนุฑุถ ุงููุฒูุฏ -->
                    <div class="stats-more">
                        <button id="stats-toggle-btn" class="stats-toggle-btn">
                            <i class="fas fa-chevron-down"></i> ุนุฑุถ ุงูุชูุงุตูู
                        </button>

                        <!-- ุฒุฑ ุชุตุฏูุฑ ุงูุฅุญุตุงุฆูุงุช -->
                        <button id="export-stats" class="btn-secondary">
                            <i class="fas fa-download"></i> ุชุตุฏูุฑ ุงูุฅุญุตุงุฆูุงุช
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </main>

    <!-- ุงูุชุฐููู -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <div class="footer-logo">
                        <i class="fas fa-hands-helping" aria-hidden="true"></i>
                        <span>ุณุงุนุฏูู</span>
                    </div>
                    <p class="footer-description">
                        ุงูููุตุฉ ุงูุดุงููุฉ ููุจุญุซ ุนู ุงููุคุณุณุงุช ูุงูุฎุฏูุงุช ูู ุฌููุน ูุฏู ุงูุฌุฒุงุฆุฑ
                    </p>
                    <div class="app-badges">
                        <a href="#" class="app-badge" aria-label="ุชุญููู ูู ูุชุฌุฑ Google Play">
                            <i class="fab fa-google-play"></i>
                            <span>Google Play</span>
                        </a>
                        <a href="#" class="app-badge" aria-label="ุชุญููู ูู ูุชุฌุฑ App Store">
                            <i class="fab fa-app-store"></i>
                            <span>App Store</span>
                        </a>
                    </div>
                </div>

                <div class="footer-section">
                    <h3>ุฑูุงุจุท ุณุฑูุนุฉ</h3>
                    <ul class="footer-links">
                        <li><a href="index.html">ุงูุฑุฆูุณูุฉ</a></li>
                        <li><a href="search.html">ุงูุจุญุซ ุงููุชูุฏู</a></li>
                        <li><a href="categories.html">ุฌููุน ุงููุฆุงุช</a></li>
                        <li><a href="add-business.html">ุฃุถู ูุคุณุณุชู</a></li>
                        <li><a href="business-owner.html">ููุญุฉ ุชุญูู ุงููุคุณุณุงุช</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>ุงููุฆุงุช ุงูุฑุฆูุณูุฉ</h3>
                    <ul class="footer-links">
                        <li><a href="category.html?cat=hospital">ุงููุณุชุดููุงุช</a></li>
                        <li><a href="category.html?cat=clinic">ุงูุนูุงุฏุงุช</a></li>
                        <li><a href="category.html?cat=pharmacy">ุงูุตูุฏููุงุช</a></li>
                        <li><a href="category.html?cat=doctor">ุงูุฃุทุจุงุก</a></li>
                        <li><a href="category.html?cat=dentist">ุฃุทุจุงุก ุงูุฃุณูุงู</a></li>
                    </ul>
                </div>

                <div class="footer-section">
                    <h3>ุงุชุตู ุจูุง</h3>
                    <ul class="footer-contact">
                        <li><i class="fas fa-envelope" aria-hidden="true"></i> contact@saaedni.dz</li>
                        <li><i class="fas fa-phone" aria-hidden="true"></i> 0560 12 34 56</li>
                        <li><i class="fas fa-map-marker-alt" aria-hidden="true"></i> ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ</li>
                    </ul>
                    <div class="newsletter">
                        <h4>ุงุดุชุฑู ูู ุงููุดุฑุฉ ุงูุฅุฎุจุงุฑูุฉ</h4>
                        <form class="newsletter-form">
                            <input type="email" placeholder="ุจุฑูุฏู ุงูุฅููุชุฑููู" aria-label="ุงูุจุฑูุฏ ุงูุฅููุชุฑููู">
                            <button type="submit" aria-label="ุงุดุชุฑู">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </form>
                    </div>
                </div>
            </div>

            <div class="footer-bottom">
                <p>&copy; 2023 ุณุงุนุฏูู. ุฌููุน ุงูุญููู ูุญููุธุฉ.</p>
                <div class="footer-bottom-links">
                    <a href="privacy.html">ุณูุงุณุฉ ุงูุฎุตูุตูุฉ</a>
                    <a href="terms.html">ุดุฑูุท ุงูุงุณุชุฎุฏุงู</a>
                    <a href="sitemap.xml">ุฎุฑูุทุฉ ุงููููุน</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- ูููุฐุฌ ุชูุงุตูู ุงููุคุณุณุฉ -->
    <div id="business-detail-modal" class="modal" role="dialog" aria-modal="true" aria-labelledby="modal-title"
        style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">ุงุณู ุงููุคุณุณุฉ</h2>
                <button class="close-modal" aria-label="ุฅุบูุงู">&times;</button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- ุณูุชู ููุคูุง ุจูุงุณุทุฉ JavaScript -->
            </div>
        </div>
    </div>

    <!-- ูุงูุฐุฉ ุชุญููู -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner large"></div>
            <p class="loading-text">ุฌุงุฑู ุงูุชุญููู...</p>
        </div>
    </div>

    <!-- ุชุญููู ููุชุจุงุช JavaScript -->
    <!-- ุชุญููู ููุชุจุงุช JavaScript -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <!-- ูููุงุช JavaScript ุงูุฑุฆูุณูุฉ -->
    <script src="js/config.js"></script>
    <script src="js/data.service.js"></script>
    <script src="js/search.engine.js"></script>
    <script src="js/map.manager.js"></script>
    <script src="js/stats.manager.js"></script>

    <script src="js/app.js"></script>

    <!-- ุชููุฆุฉ ุงูุชุทุจูู -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            try {
                // ุงูุชุญูู ูู ุชููุฑ Leaflet
                if (typeof L === 'undefined') {
                    console.error('โ ููุชุจุฉ Leaflet ูู ุชุญูู');
                    showError('ุชุนุฐุฑ ุชุญููู ุงูุฎุฑูุทุฉ. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ.');
                    return;
                }

                // ุชููุฆุฉ ุงูุชุทุจูู
                if (typeof initApp === 'function') {
                    initApp();
                } else {
                    // ุชููุฆุฉ ุจุฏููุฉ ุฅุฐุง ูู ููู app.js ูุญููุงู
                    initBackupApp();
                }

                console.log('โ ุชู ุชุญููู ุงูุชุทุจูู ุจูุฌุงุญ');
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุชููุฆุฉ ุงูุชุทุจูู:', error);
                showError('ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงูุชุทุจูู: ' + error.message);
            }
        });

        // ุชููุฆุฉ ุงุญุชูุงุทูุฉ
        function initBackupApp() {
            console.log('โก ุงุณุชุฎุฏุงู ุชููุฆุฉ ุงุญุชูุงุทูุฉ');

            // ุชููุฆุฉ ุงูุฎุฑูุทุฉ
            if (typeof initMap === 'function') {
                initMap();
            }

            // ุชููุฆุฉ ุงููุงุฆูุฉ ุงููุชูููุฉ
            initMobileMenu();

            // ุชููุฆุฉ ุงูุจุญุซ
            initSearch();

            // ุชุญููู ุงูุจูุงูุงุช
            loadBusinessesData();
        }

        // ูุธุงุฆู ูุณุงุนุฏุฉ
        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'global-error';
            errorDiv.innerHTML = `
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <p>${message}</p>
            <button onclick="location.reload()" class="btn-retry">
                <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
            </button>
        </div>
    `;
            document.body.appendChild(errorDiv);
        }

        // ุชููุฆุฉ ุงููุงุฆูุฉ ุงููุชูููุฉ
        function initMobileMenu() {
            const toggleBtn = document.getElementById('mobile-menu-toggle');
            const navLinks = document.getElementById('main-nav');

            if (toggleBtn && navLinks) {
                toggleBtn.addEventListener('click', function () {
                    const isExpanded = this.getAttribute('aria-expanded') === 'true';
                    this.setAttribute('aria-expanded', !isExpanded);
                    navLinks.classList.toggle('show');
                });
            }
        }

        // ุชููุฆุฉ ุงูุจุญุซ ุงูุฃุณุงุณู
        function initSearch() {
            const searchBtn = document.getElementById('search-btn');
            const searchForm = document.getElementById('search-form');

            if (searchForm) {
                searchForm.addEventListener('submit', function (e) {
                    e.preventDefault();
                    performSearch();
                });
            }

            if (searchBtn) {
                searchBtn.addEventListener('click', performSearch);
            }
        }

        // ุชูููุฐ ุงูุจุญุซ
        function performSearch() {
            const searchInput = document.getElementById('main-search');
            const locationInput = document.getElementById('location-search');
            const categorySelect = document.getElementById('category-select');

            const query = {
                keyword: searchInput ? searchInput.value : '',
                location: locationInput ? locationInput.value : '',
                category: categorySelect ? categorySelect.value : ''
            };

            console.log('๐ ุจุญุซ:', query);

            // ููุง ุณูุชู ุงุณุชุฏุนุงุก ูุญุฑู ุงูุจุญุซ
            if (typeof window.SearchEngine !== 'undefined') {
                window.SearchEngine.search(query);
            } else {
                console.warn('ูุญุฑู ุงูุจุญุซ ุบูุฑ ูุชููุฑุ ุงุณุชุฎุฏุงู ุงูุจุญุซ ุงููุญูู');
                localSearch(query);
            }
        }

        // ุจุญุซ ูุญูู ุจุฏูู
        function localSearch(query) {
            // ุณูุชู ุชูููุฐ ุงูุจุญุซ ุนูู ุงูุจูุงูุงุช ุงููุญููุฉ
            console.log('ุจุญุซ ูุญูู:', query);
        }

        // ุชุญููู ุจูุงูุงุช ุงููุคุณุณุงุช
        function loadBusinessesData() {
            // ูุญุงููุฉ ุชุญููู ุงูุจูุงูุงุช ูู ุงููููุงุช
            if (typeof window.BusinessDataService !== 'undefined') {
                window.BusinessDataService.loadData();
            } else {
                console.warn('ุฎุฏูุฉ ุงูุจูุงูุงุช ุบูุฑ ูุชููุฑุฉุ ุงุณุชุฎุฏุงู ุจูุงูุงุช ุงุญุชูุงุทูุฉ');
                loadBackupData();
            }
        }

        // ุชุญููู ุจูุงูุงุช ุงุญุชูุงุทูุฉ
        function loadBackupData() {
            // ุจูุงูุงุช ุงุฎุชุจุงุฑูุฉ ุฃุณุงุณูุฉ
            const backupData = [
                {
                    id: 1,
                    name: "ูุณุชุดูู ูุตุทูู ุจุงุดุง ุงูุฌุงูุนู",
                    category: "hospital",
                    address: "ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ",
                    lat: 36.7631,
                    lng: 3.0506,
                    phone: ["021 23 45 67"],
                    rating: 4.2,
                    featured: true
                },
                {
                    id: 2,
                    name: "ุตูุฏููุฉ ุงูุฃูู",
                    category: "pharmacy",
                    address: "ุญู ุงููุตุฑุ ุงูุฌุฒุงุฆุฑ",
                    lat: 36.7489,
                    lng: 3.0588,
                    phone: ["021 34 56 78"],
                    rating: 4.5,
                    featured: true
                }
            ];

            // ุชุฎุฒูู ุงูุจูุงูุงุช ููุงุณุชุฎุฏุงู
            window.backupBusinessesData = backupData;

            // ุนุฑุถ ุงูุจูุงูุงุช
            displayBusinesses(backupData);
            displayFeaturedBusinesses(backupData.filter(b => b.featured));
            updateStatistics(backupData);
        }

        // ุนุฑุถ ุงููุคุณุณุงุช
        function displayBusinesses(businesses) {
            const resultsContainer = document.getElementById('business-results');
            if (!resultsContainer || !businesses) return;

            if (businesses.length === 0) {
                resultsContainer.innerHTML = `
            <div class="no-results">
                <i class="fas fa-search" aria-hidden="true"></i>
                <p>ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุจุญุซ</p>
            </div>
        `;
                return;
            }

            let html = '';
            businesses.forEach(business => {
                html += createBusinessCard(business);
            });

            resultsContainer.innerHTML = html;
            document.getElementById('results-count').textContent = businesses.length;
        }

        // ุฅูุดุงุก ุจุทุงูุฉ ุงููุคุณุณุฉ
        function createBusinessCard(business) {
            const stars = generateRatingStars(business.rating || 0);
            const categoryName = getCategoryName(business.category);
            const icon = getCategoryIcon(business.category);

            return `
        <div class="business-card" data-id="${business.id}" data-category="${business.category}">
            <div class="business-card-header">
                <div class="business-category">
                    <i class="${icon}"></i>
                    <span>${categoryName}</span>
                </div>
                ${business.featured ? '<span class="featured-badge">ูููุฒ</span>' : ''}
            </div>
            
            <div class="business-card-body">
                <h3 class="business-name">${business.name}</h3>
                <div class="business-info">
                    <div class="business-address">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${business.address || 'ุนููุงู ุบูุฑ ูุญุฏุฏ'}</span>
                    </div>
                    ${business.phone && business.phone.length > 0 ? `
                    <div class="business-phone">
                        <i class="fas fa-phone"></i>
                        <span>${business.phone[0]}</span>
                    </div>
                    ` : ''}
                </div>
                
                <div class="business-rating">
                    <div class="stars">${stars}</div>
                    <span class="rating-value">${business.rating ? business.rating.toFixed(1) : '0.0'}</span>
                </div>
            </div>
            
            <div class="business-card-actions">
                <button class="btn-action btn-call" onclick="callNumber('${business.phone && business.phone[0] ? business.phone[0] : ''}')">
                    <i class="fas fa-phone"></i> ุงุชุตู
                </button>
                <button class="btn-action btn-directions" onclick="showDirections(${business.lat}, ${business.lng})">
                    <i class="fas fa-directions"></i> ุงุชุฌุงูุงุช
                </button>
                <button class="btn-action btn-details" onclick="showBusinessDetails(${business.id})">
                    <i class="fas fa-info-circle"></i> ุชูุงุตูู
                </button>
            </div>
        </div>
    `;
        }

        // ุนุฑุถ ุงููุคุณุณุงุช ุงููููุฒุฉ
        function displayFeaturedBusinesses(businesses) {
            const featuredContainer = document.getElementById('featured-grid');
            if (!featuredContainer || !businesses) return;

            if (businesses.length === 0) {
                featuredContainer.innerHTML = '<p class="no-featured">ูุง ุชูุฌุฏ ูุคุณุณุงุช ูููุฒุฉ ุญุงููุงู</p>';
                return;
            }

            let html = '';
            businesses.slice(0, 4).forEach(business => {
                const stars = generateRatingStars(business.rating || 0);
                const icon = getCategoryIcon(business.category);

                html += `
            <div class="featured-card" data-id="${business.id}">
                <div class="featured-card-header">
                    <div class="featured-icon">
                        <i class="${icon}"></i>
                    </div>
                    <div class="featured-rating">
                        ${stars}
                        <span>${business.rating ? business.rating.toFixed(1) : '0.0'}</span>
                    </div>
                </div>
                <div class="featured-card-body">
                    <h3>${business.name}</h3>
                    <p class="featured-address">${business.address || ''}</p>
                </div>
                <div class="featured-card-footer">
                    <button class="btn-view-details" onclick="showBusinessDetails(${business.id})">
                        <i class="fas fa-eye"></i> ุนุฑุถ ุงูุชูุงุตูู
                    </button>
                </div>
            </div>
        `;
            });

            featuredContainer.innerHTML = html;
        }

        // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช
        function updateStatistics(businesses) {
            if (!businesses) return;

            const stats = {
                hospital: businesses.filter(b => b.category === 'hospital').length,
                clinic: businesses.filter(b => b.category === 'clinic').length,
                pharmacy: businesses.filter(b => b.category === 'pharmacy').length,
                doctor: businesses.filter(b => b.category === 'doctor').length,
                total: businesses.length,
                featured: businesses.filter(b => b.featured).length,
                cities: new Set(businesses.map(b => b.address?.split(',')[0]).filter(Boolean)).size,
                reviews: businesses.reduce((sum, b) => sum + (b.reviewCount || 0), 0),
                avgRating: businesses.length > 0
                    ? (businesses.reduce((sum, b) => sum + (b.rating || 0), 0) / businesses.length).toFixed(1)
                    : '0.0'
            };

            // ุชุญุฏูุซ ุงูุนูุงุตุฑ
            const elements = {
                'hospital-count': stats.hospital,
                'clinic-count': stats.clinic,
                'pharmacy-count': stats.pharmacy,
                'doctor-count': stats.doctor
            };

            Object.entries(elements).forEach(([id, value]) => {
                const el = document.getElementById(id);
                if (el) el.textContent = value;
            });

            // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุงูุฅุถุงููุฉ
            const additionalStats = document.querySelectorAll('.additional-stat');
            if (additionalStats.length >= 4) {
                additionalStats[0].querySelector('.stat-value').textContent = stats.featured;
                additionalStats[1].querySelector('.stat-value').textContent = stats.cities;
                additionalStats[2].querySelector('.stat-value').textContent = stats.reviews;
                additionalStats[3].querySelector('.stat-value').textContent = stats.avgRating;
            }
        }

        // ุฏูุงู ูุณุงุนุฏุฉ
        function generateRatingStars(rating) {
            const fullStars = Math.floor(rating);
            const halfStar = rating % 1 >= 0.5;
            const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);

            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }
            if (halfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }
            return stars;
        }

        function getCategoryName(category) {
            const names = {
                'hospital': 'ูุณุชุดูู',
                'clinic': 'ุนูุงุฏุฉ',
                'pharmacy': 'ุตูุฏููุฉ',
                'doctor': 'ุทุจูุจ',
                'dentist': 'ุทุจูุจ ุฃุณูุงู',
                'laboratory': 'ูุฎุชุจุฑ',
                'association': 'ุฌูุนูุฉ'
            };
            return names[category] || 'ูุคุณุณุฉ';
        }

        function getCategoryIcon(category) {
            const icons = {
                'hospital': 'fas fa-hospital',
                'clinic': 'fas fa-clinic-medical',
                'pharmacy': 'fas fa-prescription-bottle-alt',
                'doctor': 'fas fa-user-md',
                'dentist': 'fas fa-tooth',
                'laboratory': 'fas fa-flask',
                'association': 'fas fa-hands-helping'
            };
            return icons[category] || 'fas fa-building';
        }

        // ุฏูุงู ุชูุงุนู
        function callNumber(phone) {
            if (!phone) {
                alert('ุฑูู ุงููุงุชู ุบูุฑ ูุชููุฑ');
                return;
            }
            window.open(`tel:${phone}`, '_blank');
        }

        function showDirections(lat, lng) {
            if (!lat || !lng) {
                alert('ุฅุญุฏุงุซูุงุช ุงูููุงู ุบูุฑ ูุชููุฑุฉ');
                return;
            }
            window.open(`https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}`, '_blank');
        }

        function showBusinessDetails(id) {
            const business = window.backupBusinessesData?.find(b => b.id === id);
            if (!business) {
                alert('ุชูุงุตูู ุงููุคุณุณุฉ ุบูุฑ ูุชููุฑุฉ');
                return;
            }

            // ุนุฑุถ ุงููุงูุฐุฉ ุงูููุจุซูุฉ
            const modal = document.getElementById('business-detail-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');

            if (modal && modalTitle && modalBody) {
                modalTitle.textContent = business.name;

                const stars = generateRatingStars(business.rating || 0);
                const categoryName = getCategoryName(business.category);

                modalBody.innerHTML = `
            <div class="business-detail">
                <div class="detail-header">
                    <div class="detail-category">
                        <i class="${getCategoryIcon(business.category)}"></i>
                        <span>${categoryName}</span>
                    </div>
                    <div class="detail-rating">
                        ${stars}
                        <span class="rating-value">${business.rating ? business.rating.toFixed(1) : '0.0'}</span>
                    </div>
                </div>
                
                <div class="detail-info">
                    <div class="info-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${business.address || 'ุนููุงู ุบูุฑ ูุญุฏุฏ'}</span>
                    </div>
                    
                    ${business.phone && business.phone.length > 0 ? `
                    <div class="info-item">
                        <i class="fas fa-phone"></i>
                        <div class="phone-numbers">
                            ${business.phone.map(num => `<span class="phone-number">${num}</span>`).join('')}
                        </div>
                    </div>
                    ` : ''}
                    
                    ${business.email ? `
                    <div class="info-item">
                        <i class="fas fa-envelope"></i>
                        <span>${business.email}</span>
                    </div>
                    ` : ''}
                    
                    ${business.website ? `
                    <div class="info-item">
                        <i class="fas fa-globe"></i>
                        <a href="${business.website}" target="_blank">${business.website}</a>
                    </div>
                    ` : ''}
                    
                    ${business.hours ? `
                    <div class="info-item">
                        <i class="fas fa-clock"></i>
                        <span>${business.hours}</span>
                    </div>
                    ` : ''}
                </div>
                
                ${business.description ? `
                <div class="detail-description">
                    <h4>ุงููุตู:</h4>
                    <p>${business.description}</p>
                </div>
                ` : ''}
                
                <div class="detail-actions">
                    <button class="btn-primary" onclick="callNumber('${business.phone && business.phone[0] ? business.phone[0] : ''}')">
                        <i class="fas fa-phone"></i> ุงุชุตู
                    </button>
                    <button class="btn-secondary" onclick="showDirections(${business.lat}, ${business.lng})">
                        <i class="fas fa-directions"></i> ุงุชุฌุงูุงุช
                    </button>
                </div>
            </div>
        `;

                modal.style.display = 'block';

                // ุฅุบูุงู ุงููุงูุฐุฉ
                const closeBtn = modal.querySelector('.close-modal');
                if (closeBtn) {
                    closeBtn.onclick = function () {
                        modal.style.display = 'none';
                    };
                }

                // ุฅุบูุงู ุจุงูููุฑ ุฎุงุฑุฌ ุงููุงูุฐุฉ
                modal.onclick = function (e) {
                    if (e.target === modal) {
                        modal.style.display = 'none';
                    }
                };
            }
        }
    </script>

    <!-- Service Worker for PWA -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function () {
                navigator.serviceWorker.register('service-worker.js')
                    .then(function (registration) {
                        console.log('โ ServiceWorker registration successful');
                    }, function (err) {
                        console.log('โ ServiceWorker registration failed: ', err);
                    });
            });
        }
    </script>


    <!-- ุชููุฆุฉ ุงูุชุทุจูู ุจุนุฏ ุชุญููู ุงูุตูุญุฉ -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // ุชุฃูุฏ ูู ุชุญููู ุฌููุน ุงููููุงุช
            if (window.CONFIG && window.BusinessDataModule && window.mapModule) {
                console.log('โ ุฌููุน ุงููููุงุช ูุญููุฉ ุจูุฌุงุญ');

                // ููุง ููููู ูุถุน ููุฏ ุชููุฆุฉ ุฅุถุงูู
                if (typeof initApp === 'function') {
                    initApp();
                }
            } else {
                console.error('โ ุจุนุถ ุงููููุงุช ูู ุชุญูู ุจุดูู ุตุญูุญ');

                // ูุญุงููุฉ ุฅุนุงุฏุฉ ุชุญููู ุงููููุงุช ุงูููููุฏุฉ
                if (!window.CONFIG) {
                    console.warn('โ๏ธ ููู config.js ูู ูุญูู');
                }
                if (!window.BusinessDataModule) {
                    console.warn('โ๏ธ ููู data.js ูู ูุญูู');
                }
                if (!window.mapModule) {
                    console.warn('โ๏ธ ููู map.js ูู ูุญูู');
                }
            }
        });

        /**
     * ููู map.js - ุฅุฏุงุฑุฉ ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ ููููุน ุณุงุนุฏูู
     * ูุญุชูู ุนูู ุฌููุน ูุธุงุฆู ุงูุฎุฑูุทุฉ ูุงูุฎุฑุงุฆุท
     */

        // ูุชุบูุฑุงุช ุงูุฎุฑูุทุฉ ุงูุนุงูุฉ
        let map = null;
        let markers = [];
        let userLocationMarker = null;
        let userLocation = null;
        let currentBusinessLayer = null;
        let directionsControl = null;

        /**
         * ุชููุฆุฉ ุงูุฎุฑูุทุฉ ุงูุชูุงุนููุฉ
         */
        function initMap() {
            try {
                // ุงูุชุญูู ูู ูุฌูุฏ ุนูุตุฑ ุงูุฎุฑูุทุฉ
                const mapElement = document.getElementById('map');
                if (!mapElement) {
                    console.error('ุนูุตุฑ ุงูุฎุฑูุทุฉ ุบูุฑ ููุฌูุฏ');
                    return;
                }

                // ุงุณุชุฎุฏุงู ุฅุญุฏุงุซูุงุช ุงูุฌุฒุงุฆุฑ ูู ุงูุฅุนุฏุงุฏุงุช
                const defaultCenter = window.CONFIG ? window.CONFIG.MAP.defaultCenter : [36.7538, 3.0588];
                const defaultZoom = window.CONFIG ? window.CONFIG.MAP.defaultZoom : 12;

                // ุฅูุดุงุก ุงูุฎุฑูุทุฉ
                map = L.map('map', {
                    center: defaultCenter,
                    zoom: defaultZoom,
                    zoomControl: false,
                    attributionControl: true
                });

                // ุฅุถุงูุฉ ุทุจูุฉ ุงูุฎุฑูุทุฉ ุงูุฃุณุงุณูุฉ ูู OpenStreetMap
                L.tileLayer(window.CONFIG ? window.CONFIG.APIS.LEAFLET_TILES : 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'ยฉ <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: window.CONFIG ? window.CONFIG.MAP.maxZoom : 18,
                    minZoom: window.CONFIG ? window.CONFIG.MAP.minZoom : 8,
                    detectRetina: true
                }).addTo(map);

                // ุฅุถุงูุฉ ุนูุงุตุฑ ุงูุชุญูู ุจุงูุชูุจูุฑ ูู ุงูุฒุงููุฉ ุงููุณุฑู ุงูุนููุง
                L.control.zoom({
                    position: 'topleft'
                }).addTo(map);

                // ุฅุถุงูุฉ ูููุงุณ ุงููุณุงูุฉ
                L.control.scale({
                    position: 'bottomleft',
                    imperial: false,
                    metric: true
                }).addTo(map);

                // ุฅุถุงูุฉ ุนูุงูุงุช ุงููุคุณุณุงุช ุงูุงูุชุฑุงุถูุฉ
                addBusinessMarkers(window.backupBusinessesData || []);

                // ุฅุนุฏุงุฏ ุงูุชุญููุงุช ุงูุฅุถุงููุฉ
                setupMapControls();

                // ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ ููุฎุฑูุทุฉ
                setupMapEvents();

                console.log('ุชู ุชููุฆุฉ ุงูุฎุฑูุทุฉ ุจูุฌุงุญ');

                // ุฅุฑุฌุงุน ูุงุฆู ุงูุฎุฑูุทุฉ ููุงุณุชุฎุฏุงู ุงูุฎุงุฑุฌู
                return map;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชููุฆุฉ ุงูุฎุฑูุทุฉ:', error);
                showMapError('ุชุนุฐุฑ ุชุญููู ุงูุฎุฑูุทุฉ. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ.');
            }
        }

        /**
         * ุฅุถุงูุฉ ุนูุงูุงุช ุงููุคุณุณุงุช ุนูู ุงูุฎุฑูุทุฉ
         * @param {Array} businesses - ูุตูููุฉ ุงููุคุณุณุงุช
         */
        function addBusinessMarkers(businesses) {
            try {
                // ุฅุฒุงูุฉ ุงูุนูุงูุงุช ุงูุณุงุจูุฉ
                clearMarkers();

                if (!businesses || businesses.length === 0) {
                    showNoResultsOnMap();
                    return;
                }

                // ุฅูุดุงุก ูุฌููุนุฉ ููุนูุงูุงุช
                const markerGroup = L.layerGroup().addTo(map);

                // ุฅุถุงูุฉ ุนูุงูุฉ ููู ูุคุณุณุฉ
                businesses.forEach(business => {
                    if (business.lat && business.lng && !isNaN(business.lat) && !isNaN(business.lng)) {
                        const marker = createBusinessMarker(business);
                        if (marker) {
                            marker.addTo(markerGroup);
                            markers.push(marker);
                        }
                    }
                });

                // ุชูุฑูุฒ ุงูุฎุฑูุทุฉ ุนูู ุฌููุน ุงูุนูุงูุงุช
                if (markers.length > 0) {
                    const bounds = L.latLngBounds(markers.map(m => m.getLatLng()));
                    map.fitBounds(bounds, {
                        padding: [50, 50],
                        maxZoom: 15
                    });
                }

                // ุญูุธ ูุฌููุนุฉ ุงูุนูุงูุงุช ุงูุญุงููุฉ
                currentBusinessLayer = markerGroup;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุนูุงูุงุช ุงููุคุณุณุงุช:', error);
            }
        }

        /**
         * ุฅูุดุงุก ุนูุงูุฉ ููุคุณุณุฉ ูุงุญุฏุฉ
         * @param {Object} business - ุจูุงูุงุช ุงููุคุณุณุฉ
         * @returns {L.Marker} ุนูุงูุฉ ุงููุคุณุณุฉ
         */
        function createBusinessMarker(business) {
            try {
                const icon = L.divIcon({
                    html: `
                <div class="map-marker ${business.category}" data-business-id="${business.id}">
                    <i class="${getCategoryIcon(business.category)}"></i>
                    <div class="marker-pulse"></div>
                </div>
            `,
                    className: 'custom-div-icon',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40],
                    popupAnchor: [0, -40]
                });

                const marker = L.marker([business.lat, business.lng], {
                    icon: icon,
                    title: business.name,
                    alt: business.name,
                    riseOnHover: true
                });

                // ุฅุถุงูุฉ ูุงูุฐุฉ ูุนูููุงุช ูููุคุณุณุฉ
                const popupContent = createPopupContent(business);
                marker.bindPopup(popupContent, {
                    maxWidth: 300,
                    minWidth: 250,
                    className: 'business-popup',
                    closeButton: true,
                    autoClose: false,
                    closeOnEscapeKey: true
                });

                // ุฅุถุงูุฉ ุญุฏุซ ุงูููุฑ ุนูู ุงูุนูุงูุฉ
                marker.on('click', function () {
                    highlightBusinessMarker(marker);
                    showBusinessDetails(business.id);

                    // ุชุณุฌูู ุญุฏุซ ุงูููุฑ ููุชุญูููุงุช
                    if (typeof gtag !== 'undefined') {
                        gtag('event', 'map_marker_click', {
                            'business_id': business.id,
                            'business_name': business.name,
                            'category': business.category
                        });
                    }
                });

                // ุฅุถุงูุฉ ุชุฃุซูุฑุงุช ุงูุชูุงุนู
                marker.on('mouseover', function () {
                    this.openPopup();
                    marker.setZIndexOffset(1000);
                });

                marker.on('mouseout', function () {
                    if (!this._popup._isOpen) {
                        this.closePopup();
                    }
                });

                return marker;

            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅูุดุงุก ุนูุงูุฉ ุงููุคุณุณุฉ:', error);
                return null;
            }
        }

        /**
         * ุฅูุดุงุก ูุญุชูู ูุงูุฐุฉ ุงููุนูููุงุช ูููุคุณุณุฉ
         * @param {Object} business - ุจูุงูุงุช ุงููุคุณุณุฉ
         * @returns {String} HTML ูููุงูุฐุฉ ุงูููุจุซูุฉ
         */
        function createPopupContent(business) {
            const ratingStars = generateRatingStars(business.rating);
            const categoryName = getCategoryName(business.category);

            return `
        <div class="map-popup-content">
            <div class="popup-header">
                <h3 class="popup-title">${business.name}</h3>
                <span class="popup-category">${categoryName}</span>
            </div>
            
            <div class="popup-body">
                <div class="popup-info">
                    <div class="popup-address">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>${business.address || 'ุนููุงู ุบูุฑ ูุญุฏุฏ'}</span>
                    </div>
                    
                    ${business.phone && business.phone.length > 0 ? `
                        <div class="popup-phone">
                            <i class="fas fa-phone"></i>
                            <span>${business.phone[0]}</span>
                        </div>
                    ` : ''}
                    
                    <div class="popup-rating">
                        <div class="stars">${ratingStars}</div>
                        <span class="rating-value">${business.rating.toFixed(1)}</span>
                    </div>
                </div>
                
                <div class="popup-actions">
                    <button class="popup-btn btn-call" onclick="callNumber('${business.phone && business.phone[0] ? business.phone[0] : ''}'); event.stopPropagation();">
                        <i class="fas fa-phone"></i> ุงุชุตู
                    </button>
                    <button class="popup-btn btn-directions" onclick="getDirections(${business.lat}, ${business.lng}); event.stopPropagation();">
                        <i class="fas fa-directions"></i> ุงุชุฌุงูุงุช
                    </button>
                    <button class="popup-btn btn-details" onclick="showBusinessDetails('${business.id}'); event.stopPropagation();">
                        <i class="fas fa-info-circle"></i> ุชูุงุตูู
                    </button>
                </div>
            </div>
        </div>
    `;
        }

        /**
         * ุฅุนุฏุงุฏ ุชุญููุงุช ุงูุฎุฑูุทุฉ ุงูุฅุถุงููุฉ
         */
        function setupMapControls() {
            // ุงูุชุญูู ูู ุงูุชูุจูุฑ ูุฏููุงู
            const zoomInBtn = document.getElementById('zoom-in');
            const zoomOutBtn = document.getElementById('zoom-out');
            const fullscreenBtn = document.getElementById('fullscreen-map');
            const locateMeBtn = document.getElementById('locate-me');

            if (zoomInBtn) {
                zoomInBtn.addEventListener('click', () => {
                    map.zoomIn();
                    animateButton(zoomInBtn);
                });
            }

            if (zoomOutBtn) {
                zoomOutBtn.addEventListener('click', () => {
                    map.zoomOut();
                    animateButton(zoomOutBtn);
                });
            }

            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', toggleFullscreen);
            }

            if (locateMeBtn) {
                locateMeBtn.addEventListener('click', locateUser);
            }
        }

        /**
         * ุฅุนุฏุงุฏ ุฃุญุฏุงุซ ุงูุฎุฑูุทุฉ
         */
        function setupMapEvents() {
            // ุญุฏุซ ุชุบููุฑ ุญุฌู ุงููุงูุฐุฉ
            window.addEventListener('resize', debounce(() => {
                map.invalidateSize();
            }, 250));

            // ุญุฏุซ ุชูุงุนู ูุน ุงูุฎุฑูุทุฉ
            map.on('click', function (e) {
                console.log('ููุฑุฉ ุนูู ุงูุฎุฑูุทุฉ:', e.latlng);
            });

            // ุญุฏุซ ุชุญููู ุงูุฎุฑูุทุฉ
            map.on('load', function () {
                console.log('ุชู ุชุญููู ุงูุฎุฑูุทุฉ');
                document.getElementById('map').classList.add('loaded');
            });

            // ุญุฏุซ ุชุบููุฑ ุงูุนุฑุถ
            map.on('zoomend', function () {
                updateMapBasedOnZoom();
            });
        }

        /**
         * ุชุญุฏูุซ ุงูุฎุฑูุทุฉ ุจูุงุกู ุนูู ูุณุชูู ุงูุชูุจูุฑ
         */
        function updateMapBasedOnZoom() {
            const currentZoom = map.getZoom();

            // ูููู ุฅุถุงูุฉ ููุทู ูุนุฑุถ ูุนูููุงุช ูุฎุชููุฉ ุจูุงุกู ุนูู ูุณุชูู ุงูุชูุจูุฑ
            if (currentZoom < 10) {
                // ูุณุชูู ุชูุจูุฑ ููุฎูุถ - ุนุฑุถ ูุนูููุงุช ุฃูู
                markers.forEach(marker => {
                    if (marker._popup) {
                        marker._popup.setContent(createSimplePopup(marker.business));
                    }
                });
            } else {
                // ูุณุชูู ุชูุจูุฑ ุนุงูู - ุนุฑุถ ูุนูููุงุช ูุงููุฉ
                markers.forEach(marker => {
                    if (marker._popup) {
                        marker._popup.setContent(createPopupContent(marker.business));
                    }
                });
            }
        }

        /**
         * ุฅูุดุงุก ูุงูุฐุฉ ูุนูููุงุช ูุจุณุทุฉ
         */
        function createSimplePopup(business) {
            return `
        <div class="simple-popup">
            <h4>${business.name}</h4>
            <p>${getCategoryName(business.category)}</p>
        </div>
    `;
        }

        /**
         * ุชุญุฏูุฏ ูููุน ุงููุณุชุฎุฏู ุงูุญุงูู
         */
        function locateUser() {
            if (!navigator.geolocation) {
                alert('ุงููุชุตูุญ ูุง ูุฏุนู ุฎุฏูุฉ ุชุญุฏูุฏ ุงููููุน.');
                return;
            }

            const locateBtn = document.getElementById('locate-me');
            if (locateBtn) {
                locateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุงูุชุญุฏูุฏ...';
                locateBtn.disabled = true;
            }

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    userLocation = [position.coords.latitude, position.coords.longitude];

                    // ุฅุฒุงูุฉ ุงูุนูุงูุฉ ุงูุณุงุจูุฉ ููููุน ุงููุณุชุฎุฏู
                    if (userLocationMarker) {
                        map.removeLayer(userLocationMarker);
                    }

                    // ุฅูุดุงุก ุนูุงูุฉ ูููุน ุงููุณุชุฎุฏู
                    userLocationMarker = L.marker(userLocation, {
                        icon: L.divIcon({
                            html: '<div class="user-location-marker"><i class="fas fa-location-arrow"></i></div>',
                            className: 'user-location-div-icon',
                            iconSize: [30, 30],
                            iconAnchor: [15, 30]
                        }),
                        zIndexOffset: 1000,
                        title: 'ูููุนู ุงูุญุงูู',
                        alt: 'ูููุนู ุงูุญุงูู'
                    }).addTo(map);

                    // ุฅุถุงูุฉ ุฏุงุฆุฑุฉ ูุตู ูุทุฑูุง ูุชุญุฏูุฏ ุงูุฏูุฉ
                    const accuracyCircle = L.circle(userLocation, {
                        color: '#4361ee',
                        fillColor: '#4361ee',
                        fillOpacity: 0.1,
                        radius: position.coords.accuracy
                    }).addTo(map);

                    // ุชูุจูุฑ ุงูุฎุฑูุทุฉ ุนูู ูููุน ุงููุณุชุฎุฏู
                    map.setView(userLocation, 15);

                    // ุชุญุฏูุซ ุฒุฑ ุงูุชุญุฏูุฏ
                    if (locateBtn) {
                        locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i> ูููุนู';
                        locateBtn.disabled = false;
                    }

                    // ุฅุดุนุงุฑ ุงููุณุชุฎุฏู
                    showNotification('ุชู ุชุญุฏูุฏ ูููุนู ุจูุฌุงุญ', 'success');

                    // ุชุญุฏูุซ ูุชุงุฆุฌ ุงูุจุญุซ ุจูุงุกู ุนูู ุงููููุน ุงูุฌุฏูุฏ
                    if (typeof filterAndDisplayBusinesses === 'function') {
                        setTimeout(() => filterAndDisplayBusinesses(), 500);
                    }

                },
                function (error) {
                    console.error('ุฎุทุฃ ูู ุชุญุฏูุฏ ุงููููุน:', error);

                    let errorMessage = 'ุชุนุฐุฑ ุชุญุฏูุฏ ูููุนู. ';
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage += 'ุชู ุฑูุถ ุงูุฅุฐู.';
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage += 'ูุนูููุงุช ุงููููุน ุบูุฑ ูุชุงุญุฉ.';
                            break;
                        case error.TIMEOUT:
                            errorMessage += 'ุงูุชูุช ูููุฉ ุงูุทูุจ.';
                            break;
                        default:
                            errorMessage += 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุนุฑูู.';
                    }

                    alert(errorMessage);

                    if (locateBtn) {
                        locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i> ุชุญุฏูุฏ ูููุนู';
                        locateBtn.disabled = false;
                    }
                },
                {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 0
                }
            );
        }

        /**
         * ุงูุญุตูู ุนูู ุงุชุฌุงูุงุช ูู ูููุน ุงููุณุชุฎุฏู ุฅูู ุงููุฌูุฉ
         * @param {number} destLat - ุฎุท ุนุฑุถ ุงููุฌูุฉ
         * @param {number} destLng - ุฎุท ุทูู ุงููุฌูุฉ
         */
        function getDirections(destLat, destLng) {
            let origin;

            if (userLocation) {
                origin = userLocation;
            } else {
                // ุงุณุชุฎุฏุงู ูุฑูุฒ ุงูุฎุฑูุทุฉ ุงูุญุงูู ุฅุฐุง ูู ููู ูููุน ุงููุณุชุฎุฏู ูุชุงุญุงู
                origin = map.getCenter();

                // ุณุคุงู ุงููุณุชุฎุฏู ุฅุฐุง ุฃุฑุงุฏ ุงุณุชุฎุฏุงู ูููุนู
                if (confirm('ูู ูุชู ุชุญุฏูุฏ ูููุนู. ูู ุชุฑูุฏ ุชุญุฏูุฏ ูููุนู ููุญุตูู ุนูู ุงุชุฌุงูุงุช ุฏูููุฉุ')) {
                    locateUser();
                    return;
                }
            }

            const destination = [destLat, destLng];

            // ูุชุญ ุฎุฏูุฉ ุงูุงุชุฌุงูุงุช ูู OpenStreetMap
            const originStr = `${origin.lat || origin[0]},${origin.lng || origin[1]}`;
            const destStr = `${destination[0]},${destination[1]}`;

            const directionsUrl = `https://www.openstreetmap.org/directions?engine=fossgis_osrm_car&route=${originStr};${destStr}`;

            // ูุชุญ ูู ูุงูุฐุฉ ุฌุฏูุฏุฉ
            window.open(directionsUrl, '_blank', 'noopener,noreferrer');

            // ุชุณุฌูู ุญุฏุซ ุงูุงุชุฌุงูุงุช
            if (typeof gtag !== 'undefined') {
                gtag('event', 'get_directions', {
                    'origin': originStr,
                    'destination': destStr
                });
            }
        }

        /**
         * ุฅุธูุงุฑ ุชูุงุตูู ุงููุคุณุณุฉ ุนูู ุงูุฎุฑูุทุฉ
         * @param {string} businessId - ูุนุฑู ุงููุคุณุณุฉ
         */
        function showBusinessOnMap(businessId) {
            if (!markers || markers.length === 0) return;

            const marker = markers.find(m => m.options.businessId === businessId);
            if (marker) {
                // ูุชุญ ูุงูุฐุฉ ุงููุนูููุงุช
                marker.openPopup();

                // ุชูุฑูุฒ ุงูุฎุฑูุทุฉ ุนูู ุงูุนูุงูุฉ
                map.setView(marker.getLatLng(), 15);

                // ุชุณููุท ุงูุถูุก ุนูู ุงูุนูุงูุฉ
                highlightBusinessMarker(marker);
            }
        }

        /**
         * ุชุณููุท ุงูุถูุก ุนูู ุนูุงูุฉ ุงููุคุณุณุฉ
         * @param {L.Marker} marker - ุนูุงูุฉ ุงููุคุณุณุฉ
         */
        function highlightBusinessMarker(marker) {
            // ุฅุฒุงูุฉ ุงูุชูููุฒ ูู ุฌููุน ุงูุนูุงูุงุช
            markers.forEach(m => {
                const iconElement = m.getElement();
                if (iconElement) {
                    iconElement.classList.remove('highlighted');
                }
            });

            // ุชูููุฒ ุงูุนูุงูุฉ ุงููุญุฏุฏุฉ
            const iconElement = marker.getElement();
            if (iconElement) {
                iconElement.classList.add('highlighted');

                // ุฅุถุงูุฉ ุชุฃุซูุฑ ุงููุจุถ
                iconElement.classList.add('pulse');
                setTimeout(() => {
                    iconElement.classList.remove('pulse');
                }, 1500);
            }
        }

        /**
         * ูุณุญ ุฌููุน ุงูุนูุงูุงุช ูู ุงูุฎุฑูุทุฉ
         */
        function clearMarkers() {
            if (currentBusinessLayer) {
                map.removeLayer(currentBusinessLayer);
                currentBusinessLayer = null;
            }

            markers.forEach(marker => {
                map.removeLayer(marker);
            });

            markers = [];
        }

        /**
         * ุฅุธูุงุฑ ุฑุณุงูุฉ ุนุฏู ูุฌูุฏ ูุชุงุฆุฌ ุนูู ุงูุฎุฑูุทุฉ
         */
        function showNoResultsOnMap() {
            const bounds = map.getBounds();
            const center = bounds.getCenter();

            const noResultsMarker = L.marker(center, {
                icon: L.divIcon({
                    html: `
                <div class="no-results-marker">
                    <i class="fas fa-search"></i>
                    <div class="no-results-text">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูู ูุฐู ุงูููุทูุฉ</div>
                </div>
            `,
                    className: 'no-results-div-icon',
                    iconSize: [200, 100],
                    iconAnchor: [100, 50]
                }),
                interactive: false
            }).addTo(map);

            setTimeout(() => {
                map.removeLayer(noResultsMarker);
            }, 5000);
        }

        /**
         * ุฅุธูุงุฑ ุฎุทุฃ ุนูู ุงูุฎุฑูุทุฉ
         * @param {string} message - ุฑุณุงูุฉ ุงูุฎุทุฃ
         */
        function showMapError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'map-error';
            errorDiv.innerHTML = `
        <div class="error-content">
            <i class="fas fa-exclamation-triangle"></i>
            <p>${message}</p>
            <button onclick="initMap()" class="btn-retry">
                <i class="fas fa-redo"></i> ุฅุนุงุฏุฉ ุงููุญุงููุฉ
            </button>
        </div>
    `;

            const mapElement = document.getElementById('map');
            mapElement.appendChild(errorDiv);
        }

        /**
         * ุชุจุฏูู ูุถุน ููุก ุงูุดุงุดุฉ ููุฎุฑูุทุฉ
         */
        function toggleFullscreen() {
            const mapElement = document.getElementById('map');
            const fullscreenBtn = document.getElementById('fullscreen-map');

            if (!document.fullscreenElement) {
                if (mapElement.requestFullscreen) {
                    mapElement.requestFullscreen();
                } else if (mapElement.webkitRequestFullscreen) {
                    mapElement.webkitRequestFullscreen();
                } else if (mapElement.msRequestFullscreen) {
                    mapElement.msRequestFullscreen();
                }

                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                    fullscreenBtn.setAttribute('aria-label', 'ุชุตุบูุฑ ุงูุฎุฑูุทุฉ');
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }

                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                    fullscreenBtn.setAttribute('aria-label', 'ุชูุจูุฑ ุงูุฎุฑูุทุฉ ุฅูู ููุก ุงูุดุงุดุฉ');
                }
            }
        }

        /**
         * ุฅุถุงูุฉ ุชุฃุซูุฑ ููุฒุฑ ุนูุฏ ุงูููุฑ
         * @param {HTMLElement} button - ุงูุฒุฑ
         */
        function animateButton(button) {
            button.classList.add('clicked');
            setTimeout(() => {
                button.classList.remove('clicked');
            }, 300);
        }

        /**
         * ูุธููุฉ debounce ูุชุญุณูู ุงูุฃุฏุงุก
         */
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        /**
         * ุฅุธูุงุฑ ุฅุดุนุงุฑ ูููุณุชุฎุฏู
         * @param {string} message - ุงูุฑุณุงูุฉ
         * @param {string} type - ููุน ุงูุฅุดุนุงุฑ (success, error, info)
         */
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
        <div class="notification-content">
            <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
            <span>${message}</span>
        </div>
        <button class="notification-close" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;

            document.body.appendChild(notification);

            // ุฅุธูุงุฑ ุงูุฅุดุนุงุฑ
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);

            // ุฅุฎูุงุก ุงูุฅุดุนุงุฑ ุชููุงุฆูุงู ุจุนุฏ 5 ุซูุงูู
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        /**
         * ุชุตุฏูุฑ ุงูุฏูุงู ููุงุณุชุฎุฏุงู ุงูุฎุงุฑุฌู
         */
        window.MapManager = {
            initMap,
            addBusinessMarkers,
            locateUser,
            getDirections,
            showBusinessOnMap,
            clearMarkers,
            toggleFullscreen,
            getMap: () => map,
            getUserLocation: () => userLocation
        };

        // ุชููุฆุฉ ุงูุฎุฑูุทุฉ ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function () {
            // ุชุฃุฎูุฑ ุชููุฆุฉ ุงูุฎุฑูุทุฉ ููููุงู ูุถูุงู ุชุญููู ุฌููุน ุงูุนูุงุตุฑ
            setTimeout(() => {
                if (document.getElementById('map')) {
                    initMap();
                }
            }, 100);
        });

        // ุงูุชุนุงูู ูุน ุชุบููุฑ ูุถุน ููุก ุงูุดุงุดุฉ
        document.addEventListener('fullscreenchange', function () {
            setTimeout(() => {
                if (map) {
                    map.invalidateSize();
                }
            }, 300);
        });

        document.addEventListener('webkitfullscreenchange', function () {
            setTimeout(() => {
                if (map) {
                    map.invalidateSize();
                }
            }, 300);
        });

        document.addEventListener('msfullscreenchange', function () {
            setTimeout(() => {
                if (map) {
                    map.invalidateSize();
                }
            }, 300);
        });
        /**
         * ููู stats.js - ุฅุฏุงุฑุฉ ูุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุฏููุงููููุฉ
         */

        class StatisticsManager {
            constructor() {
                this.counters = {
                    hospital: 0,
                    clinic: 0,
                    pharmacy: 0,
                    doctor: 0,
                    total: 0,
                    featured: 0,
                    cities: 0,
                    reviews: 0
                };

                this.elements = {
                    hospitalCount: document.getElementById('hospital-count'),
                    clinicCount: document.getElementById('clinic-count'),
                    pharmacyCount: document.getElementById('pharmacy-count'),
                    doctorCount: document.getElementById('doctor-count'),
                    statsToggleBtn: document.getElementById('stats-toggle-btn'),
                    additionalStats: document.getElementById('additional-stats')
                };

                this.init();
            }

            init() {
                this.calculateStatistics();
                this.setupEventListeners();
            }

            /**
             * ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช ูู ุงูุจูุงูุงุช
             */
            calculateStatistics() {
                const businesses = window.backupBusinessesData || [];

                // ุฅุนุงุฏุฉ ุชุนููู ุงูุนุฏุงุฏุงุช
                this.counters = {
                    hospital: 0,
                    clinic: 0,
                    pharmacy: 0,
                    doctor: 0,
                    total: businesses.length,
                    featured: 0,
                    cities: new Set(),
                    reviews: 0,
                    averageRating: 0
                };

                // ุญุณุงุจ ุงูุฅุญุตุงุฆูุงุช
                businesses.forEach(business => {
                    switch (business.category) {
                        case 'hospital':
                            this.counters.hospital++;
                            break;
                        case 'clinic':
                            this.counters.clinic++;
                            break;
                        case 'pharmacy':
                            this.counters.pharmacy++;
                            break;
                        case 'doctor':
                            this.counters.doctor++;
                            break;
                    }

                    if (business.featured) this.counters.featured++;
                    if (business.address) this.extractCity(business.address);
                    if (business.reviewCount) this.counters.reviews += business.reviewCount;
                    if (business.rating) this.counters.averageRating += business.rating;
                });

                this.counters.cities = this.counters.cities.size;
                this.counters.averageRating = businesses.length > 0
                    ? (this.counters.averageRating / businesses.length).toFixed(1)
                    : 0;

                this.updateDisplay();
            }

            /**
             * ุงุณุชุฎุฑุงุฌ ุงููุฏููุฉ ูู ุงูุนููุงู
             */
            extractCity(address) {
                const algerianCities = [
                    'ุงูุฌุฒุงุฆุฑ', 'ููุฑุงู', 'ูุณูุทููุฉ', 'ุนูุงุจุฉ', 'ุจุงุชูุฉ', 'ุจููุฏุฉ',
                    'ุณุทูู', 'ุชูุงุฑุช', 'ุงูุจููุฑุฉ', 'ุจุฌุงูุฉ', 'ุณูุฏู ุจูุนุจุงุณ', 'ุงูุจูุถ',
                    'ุชูุฒู ูุฒู', 'ุบุฑุฏุงูุฉ', 'ูุฑููุฉ', 'ุชููุฑุงุณุช'
                ];

                for (const city of algerianCities) {
                    if (address.includes(city)) {
                        this.counters.cities.add(city);
                        break;
                    }
                }
            }

            /**
             * ุชุญุฏูุซ ุงูุนุฑุถ ูุน ุชุฃุซูุฑุงุช ุงูุนุฏ
             */
            updateDisplay() {
                this.animateCounter(this.elements.hospitalCount, this.counters.hospital);
                this.animateCounter(this.elements.clinicCount, this.counters.clinic);
                this.animateCounter(this.elements.pharmacyCount, this.counters.pharmacy);
                this.animateCounter(this.elements.doctorCount, this.counters.doctor);

                // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุงูุฅุถุงููุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
                this.updateAdditionalStats();
            }

            /**
             * ุชุฃุซูุฑ ุงูุนุฏ ุงููุชุญุฑู ููุฃุฑูุงู
             */
            animateCounter(element, targetValue) {
                if (!element) return;

                const duration = 2000; // 2 ุซุงููุฉ
                const frameDuration = 1000 / 60; // 60 ุฅุทุงุฑ ูู ุงูุซุงููุฉ
                const totalFrames = Math.round(duration / frameDuration);
                const easeOutQuad = t => t * (2 - t);

                let frame = 0;
                const countTo = targetValue;
                const elementText = element.textContent;
                const currentValue = parseInt(elementText.replace(/,/g, '')) || 0;

                const counter = setInterval(() => {
                    frame++;

                    const progress = easeOutQuad(frame / totalFrames);
                    const currentCount = Math.round(countTo * progress);

                    // ุงูุชุฃูุฏ ูู ุฃู ุงูุนุฏ ูุง ูุชุฌุงูุฒ ุงููููุฉ ุงููุณุชูุฏูุฉ
                    const displayValue = Math.min(currentCount, countTo);

                    element.textContent = this.formatNumber(displayValue);

                    // ุฅุถุงูุฉ ุชุฃุซูุฑ ุฃุซูุงุก ุงูุนุฏ
                    if (frame < totalFrames) {
                        element.style.transform = `scale(${1 + progress * 0.1})`;
                        element.style.color = this.getColorForValue(displayValue, countTo);
                    } else {
                        element.style.transform = 'scale(1)';
                        element.style.color = '';
                        clearInterval(counter);

                        // ุฅุถุงูุฉ ุชุฃุซูุฑ ููุงุฆู
                        this.addCompletionEffect(element);
                    }
                }, frameDuration);
            }

            /**
             * ุชูุณูู ุงูุฃุฑูุงู (ุฅุถุงูุฉ ููุงุตู)
             */
            formatNumber(number) {
                return number.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
            }

            /**
             * ุงูุญุตูู ุนูู ููู ุจูุงุกู ุนูู ุงููููุฉ
             */
            getColorForValue(current, total) {
                const percentage = (current / total) * 100;

                if (percentage < 30) return '#ef476f'; // ุฃุญูุฑ
                if (percentage < 60) return '#ffd166'; // ุฃุตูุฑ
                if (percentage < 90) return '#06d6a0'; // ุฃุฎุถุฑ
                return '#118ab2'; // ุฃุฒุฑู
            }

            /**
             * ุฅุถุงูุฉ ุชุฃุซูุฑ ุนูุฏ ุงูุชูุงู ุงูุนุฏ
             */
            addCompletionEffect(element) {
                element.classList.add('completed');

                // ุฅุถุงูุฉ ุชุฃุซูุฑ ุงููุจุถ
                setTimeout(() => {
                    element.classList.remove('completed');
                }, 1000);
            }

            /**
             * ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุงูุฅุถุงููุฉ
             */
            updateAdditionalStats() {
                const additionalStats = document.querySelectorAll('.additional-stat');

                if (additionalStats.length > 0) {
                    // ุงููุคุณุณุงุช ุงููููุฒุฉ
                    if (additionalStats[0]) {
                        additionalStats[0].querySelector('.stat-value').textContent =
                            this.formatNumber(this.counters.featured);
                    }

                    // ุงููุฏู
                    if (additionalStats[1]) {
                        additionalStats[1].querySelector('.stat-value').textContent =
                            this.formatNumber(this.counters.cities);
                    }

                    // ุงูุชููููุงุช
                    if (additionalStats[2]) {
                        additionalStats[2].querySelector('.stat-value').textContent =
                            this.formatNumber(this.counters.reviews);
                    }

                    // ูุชูุณุท ุงูุชูููู
                    if (additionalStats[3]) {
                        additionalStats[3].querySelector('.stat-value').textContent =
                            this.counters.averageRating;
                    }
                }
            }

            /**
             * ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ
             */
            setupEventListeners() {
                if (this.elements.statsToggleBtn) {
                    this.elements.statsToggleBtn.addEventListener('click', () => {
                        this.toggleAdditionalStats();
                    });
                }

                // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุนูุฏ ุฅุถุงูุฉ ูุคุณุณุฉ ุฌุฏูุฏุฉ
                document.addEventListener('businessAdded', () => {
                    setTimeout(() => {
                        this.calculateStatistics();
                    }, 500);
                });

                // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุนูุฏ ุงูุจุญุซ
                document.addEventListener('searchCompleted', (event) => {
                    if (event.detail && event.detail.results) {
                        this.updateStatsFromSearch(event.detail.results);
                    }
                });
            }

            /**
             * ุชุจุฏูู ุนุฑุถ ุงูุฅุญุตุงุฆูุงุช ุงูุฅุถุงููุฉ
             */
            toggleAdditionalStats() {
                if (this.elements.additionalStats) {
                    this.elements.additionalStats.classList.toggle('show');
                    this.elements.statsToggleBtn.classList.toggle('active');

                    const icon = this.elements.statsToggleBtn.querySelector('i');
                    if (icon) {
                        icon.classList.toggle('fa-chevron-down');
                        icon.classList.toggle('fa-chevron-up');
                    }

                    // ุชุบููุฑ ูุต ุงูุฒุฑ
                    const isExpanded = this.elements.additionalStats.classList.contains('show');
                    this.elements.statsToggleBtn.innerHTML = isExpanded
                        ? '<i class="fas fa-chevron-up"></i> ุฅุฎูุงุก ุงูุชูุงุตูู'
                        : '<i class="fas fa-chevron-down"></i> ุนุฑุถ ุงูุชูุงุตูู';
                }
            }

            /**
             * ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ุจูุงุกู ุนูู ูุชุงุฆุฌ ุงูุจุญุซ
             */
            updateStatsFromSearch(results) {
                const searchStats = {
                    hospital: 0,
                    clinic: 0,
                    pharmacy: 0,
                    doctor: 0
                };

                results.forEach(business => {
                    if (searchStats.hasOwnProperty(business.category)) {
                        searchStats[business.category]++;
                    }
                });

                // ุชุญุฏูุซ ุงูุนุฏุงุฏุงุช ูุน ุชุฃุซูุฑ ุฎุงุต
                this.updateSearchStats(searchStats);
            }

            /**
             * ุชุญุฏูุซ ุฅุญุตุงุฆูุงุช ุงูุจุญุซ
             */
            updateSearchStats(stats) {
                // ุชุฎุฒูู ุงูููู ุงูุฃุตููุฉ
                const originalValues = {
                    hospital: this.counters.hospital,
                    clinic: this.counters.clinic,
                    pharmacy: this.counters.pharmacy,
                    doctor: this.counters.doctor
                };

                // ุชุญุฏูุซ ุงูุนุฑุถ ูุน ุชุฃุซูุฑ ุงูุงูุชูุงู
                this.animateTransition(originalValues, stats);
            }

            /**
             * ุชุฃุซูุฑ ุงูุงูุชูุงู ุจูู ุงูููู
             */
            animateTransition(original, target) {
                const elements = {
                    hospital: this.elements.hospitalCount,
                    clinic: this.elements.clinicCount,
                    pharmacy: this.elements.pharmacyCount,
                    doctor: this.elements.doctorCount
                };

                Object.keys(elements).forEach(key => {
                    if (elements[key]) {
                        elements[key].classList.add('updating');
                        setTimeout(() => {
                            this.animateCounter(elements[key], target[key] || 0);
                            elements[key].classList.remove('updating');
                        }, 300);
                    }
                });
            }

            /**
             * ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช ููุงุฆู
             */
            getStatistics() {
                return {
                    ...this.counters,
                    lastUpdated: new Date().toISOString()
                };
            }

            /**
             * ุชุตุฏูุฑ ุงูุฅุญุตุงุฆูุงุช ูู JSON
             */
            exportStatistics() {
                return JSON.stringify(this.getStatistics(), null, 2);
            }
        }

        // ุชููุฆุฉ ูุฏูุฑ ุงูุฅุญุตุงุฆูุงุช ุนูุฏ ุชุญููู ุงูุตูุญุฉ
        document.addEventListener('DOMContentLoaded', function () {
            window.statsManager = new StatisticsManager();

            // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู 30 ุซุงููุฉ (ููุชุญุฏูุซุงุช ุงูุฏููุงููููุฉ)
            setInterval(() => {
                if (window.statsManager) {
                    window.statsManager.calculateStatistics();
                }
            }, 30000);
        });



        // ูุธุงุฆู ุฅุถุงููุฉ ููุฅุญุตุงุฆูุงุช

        // ุชุญุฏูุซ ููุช ุขุฎุฑ ุชุญุฏูุซ
        function updateLastUpdateTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('ar-EG', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            const dateString = now.toLocaleDateString('ar-EG', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });

            const updateElement = document.getElementById('last-update');
            if (updateElement) {
                updateElement.textContent = `ุขุฎุฑ ุชุญุฏูุซ: ${timeString}`;
                updateElement.title = `ุงูุชุงุฑูุฎ: ${dateString}`;
            }
        }

        // ุชุตุฏูุฑ ุงูุฅุญุตุงุฆูุงุช
        function setupExportButton() {
            const exportBtn = document.getElementById('export-stats');
            if (exportBtn) {
                exportBtn.addEventListener('click', function () {
                    if (window.statsManager) {
                        const stats = window.statsManager.exportStatistics();
                        const blob = new Blob([stats], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);

                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `statistics-${new Date().toISOString().split('T')[0]}.json`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        URL.revokeObjectURL(url);

                        // ุฅุดุนุงุฑ ูููุณุชุฎุฏู
                        showNotification('ุชู ุชุตุฏูุฑ ุงูุฅุญุตุงุฆูุงุช ุจูุฌุงุญ', 'success');
                    }
                });
            }
        }

        // ุชุญุฏูุซ ุงููุฎุทุทุงุช ุงูุฏุงุฆุฑูุฉ
        function updateProgressCircles() {
            const circles = document.querySelectorAll('.progress-ring-circle');
            circles.forEach((circle, index) => {
                const radius = circle.r.baseVal.value;
                const circumference = radius * 2 * Math.PI;

                circle.style.strokeDasharray = `${circumference} ${circumference}`;
                circle.style.strokeDashoffset = circumference;

                // ูููุฉ ุนุดูุงุฆูุฉ ููุชุฌุฑุจุฉ (ูููู ุงุณุชุจุฏุงููุง ุจููู ุญููููุฉ)
                const progress = [85, 70, 90, 60][index] || 75;
                const offset = circumference - (progress / 100) * circumference;

                setTimeout(() => {
                    circle.style.transition = 'stroke-dashoffset 1.5s ease-in-out';
                    circle.style.strokeDashoffset = offset;
                }, index * 300);
            });
        }

        // ุชููุฆุฉ ุฌููุน ุงููุธุงุฆู
        document.addEventListener('DOMContentLoaded', function () {
            // ุชุญุฏูุซ ููุช ุงูุชุญุฏูุซ ูู ุซุงููุฉ
            updateLastUpdateTime();
            setInterval(updateLastUpdateTime, 1000);

            // ุฅุนุฏุงุฏ ุฒุฑ ุงูุชุตุฏูุฑ
            setupExportButton();

            // ุชุญุฏูุซ ุงููุฎุทุทุงุช ุงูุฏุงุฆุฑูุฉ
            setTimeout(updateProgressCircles, 1000);

            // ุชุญุฏูุซ ุงููุฎุทุทุงุช ูู 5 ุฏูุงุฆู
            setInterval(updateProgressCircles, 300000);
        });

        // ===========================================
        // ุชููุฆุฉ ุงููุชุบูุฑุงุช ุงูุนุงูุฉ
        // ===========================================
        if (!window.map) {
            window.map = ... // ุงูุชููุฆุฉ ููุง
        }
        let markers = [];
        let userLocationMarker = null;
        let userLocation = null;
        let userLocationCircle = null;
        let businessesData = [];

        // ===========================================
        // ุงูุฏูุงู ุงููุณุงุนุฏุฉ ุงูุฃุณุงุณูุฉ
        // ===========================================
        function getCategoryIcon(category) {
            const icons = {
                'restaurant': 'fas fa-utensils',
                'cafe': 'fas fa-coffee',
                'hotel': 'fas fa-hotel',
                'hospital': 'fas fa-hospital',
                'pharmacy': 'fas fa-prescription-bottle',
                'bank': 'fas fa-university',
                'market': 'fas fa-shopping-cart',
                'default': 'fas fa-map-marker-alt'
            };
            return icons[category] || icons.default;
        }

        // ===========================================
        // ุชููุฆุฉ ุงูุฎุฑูุทุฉ
        // ===========================================
        function initMap() {
            try {
                // ุฅุญุฏุงุซูุงุช ุงูุฌุฒุงุฆุฑ ุงููุณุทู
                const algeriaCenter = [36.7063956, 3.211357];

                // ุฅูุดุงุก ุงูุฎุฑูุทุฉ
                map = L.map('map').setView(algeriaCenter, 6);

                // ุฅุถุงูุฉ ุทุจูุฉ ุงูุฎุฑูุทุฉ ูู OpenStreetMap
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'ยฉ <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19,
                    noWrap: true
                }).addTo(map);

                // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ูู ุงููุญุฏุฉ ุงููุดุชุฑูุฉ
                businessesData = window.BusinessDataModule?.backupBusinessesData || window.backupBusinessesData || [];

                // ุฅุถุงูุฉ ุนูุงูุงุช ุงููุคุณุณุงุช
                addBusinessMarkers();

                // ุถุจุท ุงูุชุญูู ูู ุงูุชูุจูุฑ
                setupMapControls();

                console.log('ุชู ุชููุฆุฉ ุงูุฎุฑูุทุฉ ุจูุฌุงุญ');
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชููุฆุฉ ุงูุฎุฑูุทุฉ:', error);
                showErrorMessage('ุชุนุฐุฑ ุชุญููู ุงูุฎุฑูุทุฉ. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ.');
            }
        }

        // ===========================================
        // ุฅุถุงูุฉ ุนูุงูุงุช ุงููุคุณุณุงุช ุนูู ุงูุฎุฑูุทุฉ
        // ===========================================
        function addBusinessMarkers() {
            try {
                // ุฅุฒุงูุฉ ุงูุนูุงูุงุช ุงูุณุงุจูุฉ
                clearAllMarkers();

                if (!businessesData || businessesData.length === 0) {
                    console.warn('ูุง ุชูุฌุฏ ุจูุงูุงุช ูููุคุณุณุงุช');
                    return;
                }

                // ุฅุถุงูุฉ ุนูุงูุงุช ุฌุฏูุฏุฉ
                businessesData.forEach(business => {
                    if (business.lat && business.lng && !isNaN(business.lat) && !isNaN(business.lng)) {
                        try {
                            const icon = L.divIcon({
                                html: `
                            <div class="map-marker ${business.category}" title="${business.name}">
                                <i class="${getCategoryIcon(business.category)}"></i>
                            </div>
                        `,
                                className: 'custom-div-icon',
                                iconSize: [40, 40],
                                iconAnchor: [20, 40],
                                popupAnchor: [0, -40]
                            });

                            const marker = L.marker([business.lat, business.lng], { icon })
                                .addTo(map)
                                .bindPopup(createMarkerPopup(business), {
                                    maxWidth: 300,
                                    minWidth: 250
                                });

                            marker.businessId = business.id;
                            marker.businessData = business;
                            markers.push(marker);
                        } catch (markerError) {
                            console.error(`ุฎุทุฃ ูู ุฅุถุงูุฉ ุนูุงูุฉ ูููุคุณุณุฉ ${business.name}:`, markerError);
                        }
                    }
                });

                console.log(`ุชู ุฅุถุงูุฉ ${markers.length} ุนูุงูุฉ ุนูู ุงูุฎุฑูุทุฉ`);
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุนูุงูุงุช:', error);
            }
        }

        // ===========================================
        // ุฅูุดุงุก ูุงูุฐุฉ ููุจุซูุฉ ููุนูุงูุฉ
        // ===========================================
        function createMarkerPopup(business) {
            const generateRatingStars = window.BusinessDataModule?.generateRatingStars ||
                window.businessDataModule?.generateRatingStars ||
                (() => '');

            return `
        <div class="map-popup">
            <div class="popup-header">
                <i class="${getCategoryIcon(business.category)}"></i>
                <h3>${business.name}</h3>
            </div>
            <div class="popup-content">
                <p class="popup-address">${business.address || 'ูุง ููุฌุฏ ุนููุงู'}</p>
                <div class="popup-rating">
                    ${generateRatingStars(business.rating || 0)}
                    <span class="rating-value">${business.rating || 0}</span>
                </div>
            </div>
            <div class="popup-actions">
                <button class="popup-btn" onclick="showBusinessDetails(${business.id})">
                    <i class="fas fa-info-circle"></i> ุงูุชูุงุตูู
                </button>
                <button class="popup-btn" onclick="getDirections(${business.lat}, ${business.lng})">
                    <i class="fas fa-directions"></i> ุงูุงุชุฌุงูุงุช
                </button>
            </div>
        </div>
    `;
        }

        // ===========================================
        // ุฅุนุฏุงุฏ ุชุญููุงุช ุงูุฎุฑูุทุฉ
        // ===========================================
        function setupMapControls() {
            try {
                // ุชูุจูุฑ
                const zoomInBtn = document.getElementById('zoom-in');
                if (zoomInBtn) {
                    zoomInBtn.addEventListener('click', () => {
                        map.zoomIn();
                        updateZoomLevel();
                    });
                }

                // ุชุตุบูุฑ
                const zoomOutBtn = document.getElementById('zoom-out');
                if (zoomOutBtn) {
                    zoomOutBtn.addEventListener('click', () => {
                        map.zoomOut();
                        updateZoomLevel();
                    });
                }

                // ููุก ุงูุดุงุดุฉ
                const fullscreenBtn = document.getElementById('fullscreen-map');
                if (fullscreenBtn) {
                    fullscreenBtn.addEventListener('click', toggleFullscreen);
                }

                // ุชุญุฏูุฏ ูููุนู
                const locateBtn = document.getElementById('locate-me');
                if (locateBtn) {
                    locateBtn.addEventListener('click', locateUser);
                }

                // ุชุญุฏูุซ ูุณุชูู ุงูุชูุจูุฑ ุนูุฏ ุชุบููุฑู
                map.on('zoomend', updateZoomLevel);

                console.log('ุชู ุฅุนุฏุงุฏ ุชุญููุงุช ุงูุฎุฑูุทุฉ');
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุนุฏุงุฏ ุชุญููุงุช ุงูุฎุฑูุทุฉ:', error);
            }
        }

        // ===========================================
        // ุชุญุฏูุซ ูุณุชูู ุงูุชูุจูุฑ ุงููุนุฑูุถ
        // ===========================================
        function updateZoomLevel() {
            const zoomLevel = document.getElementById('zoom-level');
            if (zoomLevel && map) {
                zoomLevel.textContent = `ุงูุชูุจูุฑ: ${map.getZoom()}`;
            }
        }

        // ===========================================
        // ุชุจุฏูู ูุถุน ููุก ุงูุดุงุดุฉ
        // ===========================================
        function toggleFullscreen() {
            const mapElement = document.getElementById('map');

            if (!document.fullscreenElement) {
                if (mapElement.requestFullscreen) {
                    mapElement.requestFullscreen();
                } else if (mapElement.webkitRequestFullscreen) {
                    mapElement.webkitRequestFullscreen();
                } else if (mapElement.msRequestFullscreen) {
                    mapElement.msRequestFullscreen();
                }

                // ุฅุนุงุฏุฉ ุถุจุท ุญุฌู ุงูุฎุฑูุทุฉ ุนูุฏ ุงูุฏุฎูู ูู ูุถุน ููุก ุงูุดุงุดุฉ
                setTimeout(() => map.invalidateSize(), 300);
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    document.msExitFullscreen();
                }
            }
        }

        // ===========================================
        // ุชุญุฏูุฏ ูููุน ุงููุณุชุฎุฏู
        // ===========================================
        function locateUser() {
            const locateBtn = document.getElementById('locate-me');

            if (!locateBtn) {
                console.error('ุฒุฑ ุชุญุฏูุฏ ุงููููุน ุบูุฑ ููุฌูุฏ');
                return;
            }

            // ุชุบููุฑ ุญุงูุฉ ุงูุฒุฑ ุฃุซูุงุก ุงูุชุญููู
            const originalHTML = locateBtn.innerHTML;
            locateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุชุญุฏูุฏ ุงููููุน...';
            locateBtn.disabled = true;

            // ุงูุชุญูู ูู ุฏุนู ุงููุชุตูุญ ูููููุน ุงูุฌุบุฑุงูู
            if (!navigator.geolocation) {
                showErrorMessage('ูุชุตูุญู ูุง ูุฏุนู ุฎุฏูุฉ ุชุญุฏูุฏ ุงููููุน.');
                resetLocateButton(locateBtn, originalHTML);
                return;
            }

            // ุฎูุงุฑุงุช ุฃูุซุฑ ุฏูุฉ
            const options = {
                enableHighAccuracy: true,
                timeout: 15000,
                maximumAge: 0
            };

            // ูุญุงููุฉ ุงูุญุตูู ุนูู ุงููููุน
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    handleLocationSuccess(position);
                    resetLocateButton(locateBtn, originalHTML);
                },
                (error) => {
                    handleLocationError(error);
                    resetLocateButton(locateBtn, originalHTML);
                },
                options
            );
        }

        // ===========================================
        // ูุนุงูุฌุฉ ูุฌุงุญ ุชุญุฏูุฏ ุงููููุน
        // ===========================================
        function handleLocationSuccess(position) {
            try {
                userLocation = [position.coords.latitude, position.coords.longitude];
                const accuracy = position.coords.accuracy || 50;

                // ุฅุฒุงูุฉ ุงูุนูุงูุงุช ุงูุณุงุจูุฉ
                if (userLocationMarker) {
                    map.removeLayer(userLocationMarker);
                }
                if (userLocationCircle) {
                    map.removeLayer(userLocationCircle);
                }

                // ุฅุถุงูุฉ ุนูุงูุฉ ูููุน ุงููุณุชุฎุฏู
                userLocationMarker = L.marker(userLocation, {
                    icon: L.divIcon({
                        html: '<div class="user-location-marker"><i class="fas fa-location-arrow"></i></div>',
                        className: 'custom-div-icon user-location-icon',
                        iconSize: [40, 40],
                        iconAnchor: [20, 40]
                    }),
                    zIndexOffset: 1000,
                    title: 'ูููุนู ุงูุญุงูู'
                }).addTo(map);

                // ุฅุถุงูุฉ ุฏุงุฆุฑุฉ ุชูุถุญ ุฏูุฉ ุงููููุน
                userLocationCircle = L.circle(userLocation, {
                    color: '#4285f4',
                    fillColor: '#4285f4',
                    fillOpacity: 0.2,
                    radius: accuracy
                }).addTo(map);

                // ุชูุจูุฑ ุงูุฎุฑูุทุฉ ุนูู ูููุน ุงููุณุชุฎุฏู
                map.setView(userLocation, 15);

                // ุนุฑุถ ุฑุณุงูุฉ ูุฌุงุญ
                showSuccessMessage('ุชู ุชุญุฏูุฏ ูููุนู ุจูุฌุงุญ!');

                // ุชุญุฏูุซ ุงูุจุญุซ ุญุณุจ ุงููููุน
                setTimeout(() => {
                    filterAndDisplayBusinesses();
                    highlightNearbyBusinesses();
                }, 500);

                console.log('ุชู ุชุญุฏูุฏ ูููุน ุงููุณุชุฎุฏู:', userLocation, 'ุฏูุฉ:', accuracy + 'ู');
            } catch (error) {
                console.error('ุฎุทุฃ ูู ูุนุงูุฌุฉ ูููุน ุงููุณุชุฎุฏู:', error);
                showErrorMessage('ุญุฏุซ ุฎุทุฃ ูู ูุนุงูุฌุฉ ูููุนู.');
            }
        }

        // ===========================================
        // ูุนุงูุฌุฉ ุฎุทุฃ ุชุญุฏูุฏ ุงููููุน
        // ===========================================
        function handleLocationError(error) {
            let message = 'ุชุนุฐุฑ ุงูุญุตูู ุนูู ูููุนู.';
            let details = '';

            switch (error.code) {
                case error.PERMISSION_DENIED:
                    message = 'ุชู ุฑูุถ ุงูุฅุฐู ุจุงููุตูู ุฅูู ุงููููุน.';
                    details = 'ูุฑุฌู ุงูุณูุงุญ ุจุงููุตูู ุฅูู ุงููููุน ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ.';
                    break;
                case error.POSITION_UNAVAILABLE:
                    message = 'ูุนูููุงุช ุงููููุน ุบูุฑ ูุชููุฑุฉ.';
                    details = 'ูุฑุฌู ุงูุชุฃูุฏ ูู ุชูุนูู ุฎุฏูุฉ ุงููููุน ุนูู ุฌูุงุฒู.';
                    break;
                case error.TIMEOUT:
                    message = 'ุงูุชูุช ุงููููุฉ ูู ุงูุชุธุงุฑ ุงููููุน.';
                    details = 'ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู ูู ููุงู ุฐู ุฅุดุงุฑุฉ ุฃูุถู.';
                    break;
                default:
                    message = 'ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุนุฑูู ุฃุซูุงุก ุชุญุฏูุฏ ุงููููุน.';
                    details = `ุฎุทุฃ ${error.code}: ${error.message}`;
            }

            // ุนุฑุถ ุฑุณุงูุฉ ุชูุตูููุฉ
            showErrorMessage(`${message} ${details}`);

            // ุงูุชุฑุงุญ ุงุณุชุฎุฏุงู ูููุน ุงูุชุฑุงุถู
            setTimeout(() => {
                if (confirm('ูู ุชุฑูุฏ ุงุณุชุฎุฏุงู ูุฑูุฒ ุงููุฏููุฉ ููููุน ุจุฏููุ')) {
                    useDefaultLocation();
                }
            }, 2000);

            console.error('ุฎุทุฃ ูู ุชุญุฏูุฏ ุงููููุน:', error);
        }

        // ===========================================
        // ุงุณุชุฎุฏุงู ูููุน ุงูุชุฑุงุถู
        // ===========================================
        function useDefaultLocation() {
            // ุงุณุชุฎุฏุงู ูููุน ุงููุฑูุฒ ุงูุชุฌุงุฑู ุฃู ุงููุฏููุฉ ูุจุฏูู
            const defaultLocation = [36.7063956, 3.211357]; // ุงูุฌุฒุงุฆุฑ ุงููุณุทู

            userLocation = defaultLocation;
            const accuracy = 1000; // ุฏูุฉ ุงูุชุฑุงุถูุฉ 1 ูู

            // ุฅุถุงูุฉ ุนูุงูุฉ ุงููููุน ุงูุงูุชุฑุงุถู
            userLocationMarker = L.marker(defaultLocation, {
                icon: L.divIcon({
                    html: '<div class="user-location-marker default"><i class="fas fa-map-marker-alt"></i></div>',
                    className: 'custom-div-icon user-location-icon',
                    iconSize: [40, 40],
                    iconAnchor: [20, 40]
                }),
                zIndexOffset: 1000,
                title: 'ุงููููุน ุงูุงูุชุฑุงุถู (ูุฑูุฒ ุงููุฏููุฉ)'
            }).addTo(map);

            map.setView(defaultLocation, 12);
            showSuccessMessage('ุชู ุงุณุชุฎุฏุงู ูููุน ูุฑูุฒ ุงููุฏููุฉ ูุจุฏูู.');

            // ุชุญุฏูุซ ุงูุจุญุซ ุญุณุจ ุงููููุน ุงูุงูุชุฑุงุถู
            setTimeout(() => {
                filterAndDisplayBusinesses();
                highlightNearbyBusinesses();
            }, 500);
        }

        // ===========================================
        // ุฅุนุงุฏุฉ ุถุจุท ุฒุฑ ุชุญุฏูุฏ ุงููููุน
        // ===========================================
        function resetLocateButton(locateBtn, originalHTML) {
            if (locateBtn) {
                setTimeout(() => {
                    locateBtn.innerHTML = originalHTML || '<i class="fas fa-location-arrow"></i> ูููุนู';
                    locateBtn.disabled = false;
                }, 1000);
            }
        }

        // ===========================================
        // ุฅุจุฑุงุฒ ุงููุคุณุณุงุช ุงููุฑูุจุฉ
        // ===========================================
        function highlightNearbyBusinesses() {
            if (!userLocation) return;

            const radiusSelect = document.getElementById('radius-select');
            const radius = radiusSelect ? parseInt(radiusSelect.value) * 1000 : 5000;

            markers.forEach(marker => {
                if (marker.businessData && marker.businessData.lat && marker.businessData.lng) {
                    const distance = getDistance(
                        userLocation[0], userLocation[1],
                        marker.businessData.lat, marker.businessData.lng
                    );

                    if (distance <= radius) {
                        // ุฅุถุงูุฉ ูุฆุฉ ููุนูุงูุงุช ุงููุฑูุจุฉ
                        marker.getElement()?.classList?.add('nearby-marker');
                    } else {
                        marker.getElement()?.classList?.remove('nearby-marker');
                    }
                }
            });
        }

        // ===========================================
        // ุจุงูู ุงูุฏูุงู (ุชู ุญุฐููุง ููุฅูุฌุงุฒ ูููู ูุฌุจ ุฃู ุชุจูู ููุง ูู)
        // ===========================================
        // [ุฌููุน ุงูุฏูุงู ุงูุฃุฎุฑู ุชุจูู ููุง ูู ูุน ุชุนุฏููุงุช ุทูููุฉ ูุชุนูู ูุน ุงูุชุบููุฑุงุช]
        // ูุซู: showBusinessDetails, centerMapOnBusiness, displayBusinessDetails, etc.

        // ===========================================
        // ุนุฑุถ ุฑุณุงุฆู ูููุณุชุฎุฏู
        // ===========================================
        function showErrorMessage(message) {
            showMessage(message, 'error');
        }

        function showSuccessMessage(message) {
            showMessage(message, 'success');
        }

        function showMessage(message, type) {
            // ุฅูุดุงุก ุนูุตุฑ ุงูุฑุณุงูุฉ ุฅุฐุง ูู ููู ููุฌูุฏุงู
            let messageContainer = document.getElementById('message-container');
            if (!messageContainer) {
                messageContainer = document.createElement('div');
                messageContainer.id = 'message-container';
                document.body.appendChild(messageContainer);
            }

            const messageElement = document.createElement('div');
            messageElement.className = `message ${type}`;
            messageElement.innerHTML = `
        <i class="fas fa-${type === 'error' ? 'exclamation-circle' : 'check-circle'}"></i>
        <span>${message}</span>
        <button class="close-message" onclick="this.parentElement.remove()">
            <i class="fas fa-times"></i>
        </button>
    `;

            messageContainer.appendChild(messageElement);

            // ุฅุฒุงูุฉ ุงูุฑุณุงูุฉ ุชููุงุฆูุงู ุจุนุฏ 5 ุซูุงูู
            setTimeout(() => {
                if (messageElement.parentElement) {
                    messageElement.remove();
                }
            }, 5000);
        }

        // ===========================================
        // ุญุณุงุจ ุงููุณุงูุฉ ุจูู ุฅุญุฏุงุซููู (ุจุงููููููุชุฑุงุช)
        // ===========================================
        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // ูุตู ูุทุฑ ุงูุฃุฑุถ ุจุงููููููุชุฑ
            const dLat = toRad(lat2 - lat1);
            const dLon = toRad(lon2 - lon1);
            const a =
                Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(toRad(lat1)) * Math.cos(toRad(lat2)) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function toRad(value) {
            return value * Math.PI / 180;
        }

        // ===========================================
        // ูุณุญ ุฌููุน ุงูุนูุงูุงุช
        // ===========================================
        function clearAllMarkers() {
            markers.forEach(marker => {
                if (map) map.removeLayer(marker);
            });
            markers = [];
        }

        // ===========================================
        // ุชููุฆุฉ ุงูุตูุญุฉ ุนูุฏ ุงูุชุญููู
        // ===========================================
        document.addEventListener('DOMContentLoaded', function () {
            try {
                // ุชููุฆุฉ ุงูุฎุฑูุทุฉ
                initMap();

                // ุนุฑุถ ุงููุคุณุณุงุช
                setTimeout(() => {
                    if (businessesData && businessesData.length > 0) {
                        displayBusinesses(businessesData);
                        displayFeaturedBusinesses();
                        updateResultsCount(businessesData.length);
                    }
                }, 500);

                // ุฅุถุงูุฉ ูุณุชูุนู ุงูุฃุญุฏุงุซ ููุจุญุซ
                setupEventListeners();

                // ุฅุบูุงู ุงููุงูุฐุฉ ุงูููุจุซูุฉ
                setupModalClose();

                // ุฅุนุฏุงุฏ ุงููุงุฆูุฉ ุงููุชูููุฉ
                setupMobileMenu();

                console.log('ุชู ุชุญููู ุงูุตูุญุฉ ุจูุฌุงุญ');
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุชููุฆุฉ ุงูุตูุญุฉ:', error);
                showErrorMessage('ุญุฏุซ ุฎุทุฃ ูู ุชุญููู ุงูุตูุญุฉ');
            }
        });

        // ===========================================
        // ุฅุนุฏุงุฏ ูุณุชูุนู ุงูุฃุญุฏุงุซ
        // ===========================================
        function setupEventListeners() {
            // ุฒุฑ ุงูุจุญุซ
            const searchBtn = document.getElementById('search-btn');
            if (searchBtn) {
                searchBtn.addEventListener('click', filterAndDisplayBusinesses);
            }

            // ุงูุจุญุซ ุนูุฏ ุงูุถุบุท ุนูู Enter
            const mainSearch = document.getElementById('main-search');
            if (mainSearch) {
                mainSearch.addEventListener('keyup', function (event) {
                    if (event.key === 'Enter') {
                        filterAndDisplayBusinesses();
                    }
                });
            }

            // ุงูุจุญุซ ุงูุชููุงุฆู ุนูุฏ ุชุบููุฑ ุงูููุงุชุฑ
            const categorySelect = document.getElementById('category-select');
            const sortSelect = document.getElementById('sort-select');
            const radiusSelect = document.getElementById('radius-select');
            const locationSearch = document.getElementById('location-search');

            if (categorySelect) categorySelect.addEventListener('change', filterAndDisplayBusinesses);
            if (sortSelect) sortSelect.addEventListener('change', filterAndDisplayBusinesses);
            if (radiusSelect) radiusSelect.addEventListener('change', filterAndDisplayBusinesses);
            if (locationSearch) {
                locationSearch.addEventListener('change', filterAndDisplayBusinesses);
                locationSearch.addEventListener('keyup', debounce(filterAndDisplayBusinesses, 500));
            }

            // ุชุญุฏูุซ ุงูุฎุฑูุทุฉ ุนูุฏ ุชุบููุฑ ุงูุญุฌู
            window.addEventListener('resize', debounce(() => {
                if (map) map.invalidateSize();
            }, 250));
        }

        // ===========================================
        // ุฏุงูุฉ Debounce ูุชุญุณูู ุงูุฃุฏุงุก
        // ===========================================
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // ===========================================
        // ุชุตุฏูุฑ ุงูุฏูุงู ููุงุณุชุฎุฏุงู ุงูุนุงููู
        // ===========================================
        window.initMap = initMap;
        window.showBusinessDetails = showBusinessDetails;
        window.callNumber = callNumber;
        window.getDirections = getDirections;
        window.openInGoogleMaps = openInGoogleMaps;
        window.filterAndDisplayBusinesses = filterAndDisplayBusinesses;
        window.locateUser = locateUser;
        window.resetSearch = resetSearch;

        // ===========================================
        // ุฏูุงู ุงูุงุฎุชุจุงุฑ (ููุฃุบุฑุงุถ ุงูุชููููุฉ ููุท)
        // ===========================================
        console.log('ุฏุนู ุชุญุฏูุฏ ุงููููุน:', !!navigator.geolocation);

        // ูุญุงูุงุฉ ุงููุฌุงุญ (ููุงุฎุชุจุงุฑ ููุท)
        function simulateSuccess() {
            handleLocationSuccess({
                coords: {
                    latitude: 36.7063956,
                    longitude: 3.211357,
                    accuracy: 50
                }
            });
        }

        // ูุญุงูุงุฉ ุงูุฎุทุฃ (ููุงุฎุชุจุงุฑ ููุท)
        function simulateError() {
            handleLocationError({
                code: 1,
                message: 'Permission denied'
            });
        }

        window.simulateSuccess = simulateSuccess;
        window.simulateError = simulateError;

        // ===========================================
        // ููู ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู (ููุญุณูู ูููุตุญูุญ)
        // ===========================================
        const CONFIG = {
            // =======================================
            // ุฅุนุฏุงุฏุงุช ุงูุชุทุจูู
            // =======================================
            APP: {
                name: 'ุณุงุนุฏูู',
                version: '2.0.0',
                language: 'ar',
                country: 'ุงูุฌุฒุงุฆุฑ',
                direction: 'rtl',
                theme: 'light', // light | dark | auto
                enableNotifications: true,
                enableAnalytics: false,
                debugMode: false
            },

            // =======================================
            // ุฅุนุฏุงุฏุงุช API (ุงุณุชุจุฏู ุจููุงุชูุญู ุงููุนููุฉ)
            // =======================================
            APIS: {
                GOOGLE: {
                    key: 'AIzaSyDfJHn5jLQmH0ZkXyV6b8nT7cR9pA2wB3C', // ุงุณุชุจุฏู ุจููุชุงุญู ุงููุนูู
                    places: 'https://maps.googleapis.com/maps/api/place',
                    geocode: 'https://maps.googleapis.com/maps/api/geocode',
                    timeout: 10000,
                    retryAttempts: 3
                },

                OPENSTREETMAP: {
                    nominatim: 'https://nominatim.openstreetmap.org/search',
                    overpass: 'https://overpass-api.de/api/interpreter',
                    timeout: 15000,
                    rateLimit: 1000 // ูููู ุซุงููุฉ ุจูู ุงูุทูุจุงุช
                },

                GEOAPIFY: {
                    key: '', // ุงุญุตู ุนูู ููุชุงุญ ูุฌุงูู ูู geoapify.com
                    reverseGeocode: 'https://api.geoapify.com/v1/geocode/reverse'
                }
            },

            // =======================================
            // ุฅุนุฏุงุฏุงุช ุงููููุน ุงูุฌุบุฑุงูู
            // =======================================
            LOCATION: {
                // ุงููููุน ุงูุงูุชุฑุงุถู (ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ)
                DEFAULT: {
                    lat: 36.7538,
                    lng: 3.0588,
                    name: 'ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ, ุงูุฌุฒุงุฆุฑ',
                    zoom: 12
                },

                // ุญุฏูุฏ ุงูุฌุฒุงุฆุฑ ููุชุญูู
                ALGERIA_BOUNDS: {
                    north: 37.0939,
                    south: 18.9600,
                    west: -8.6739,
                    east: 11.9798
                },

                // ุฅุนุฏุงุฏุงุช ุชุญุฏูุฏ ุงููููุน
                GEOLOCATION: {
                    enableHighAccuracy: true,
                    timeout: 10000,
                    maximumAge: 60000, // ุงุณุชุฎุฏุงู ูููุน ูุฎุฒู ูุฃูู ูู ุฏูููุฉ
                    watch: false, // ุชุชุจุน ุงููููุน ุงููุณุชูุฑ
                    minimumDistance: 10, // ุงูุญุฏ ุงูุฃุฏูู ูููุณุงูุฉ ุจุงููุชุฑ ููุชุญุฏูุซ
                    circleRadius: 50, // ูุตู ูุทุฑ ุฏุงุฆุฑุฉ ุงูุฏูุฉ ุจุงููุชุฑ
                    circleOpacity: 0.2
                }
            },

            // =======================================
            // ุงููุฏู ุงูุฌุฒุงุฆุฑูุฉ ุงูุฑุฆูุณูุฉ ูุน ุฅุญุฏุงุซูุงุชูุง
            // =======================================
            CITIES: [
                {
                    name: 'ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ',
                    lat: 36.7538,
                    lng: 3.0588,
                    population: 3415811,
                    wilaya: 'ุงูุฌุฒุงุฆุฑ'
                },
                {
                    name: 'ููุฑุงู',
                    lat: 35.6971,
                    lng: -0.6359,
                    population: 803329,
                    wilaya: 'ููุฑุงู'
                },
                {
                    name: 'ูุณูุทููุฉ',
                    lat: 36.3650,
                    lng: 6.6147,
                    population: 448374,
                    wilaya: 'ูุณูุทููุฉ'
                },
                {
                    name: 'ุนูุงุจุฉ',
                    lat: 36.9000,
                    lng: 7.7667,
                    population: 257359,
                    wilaya: 'ุนูุงุจุฉ'
                },
                {
                    name: 'ุจุงุชูุฉ',
                    lat: 35.5560,
                    lng: 6.1746,
                    population: 290645,
                    wilaya: 'ุจุงุชูุฉ'
                },
                {
                    name: 'ุจููุฏุฉ',
                    lat: 36.4700,
                    lng: 2.8300,
                    population: 163586,
                    wilaya: 'ุจููุฏุฉ'
                },
                {
                    name: 'ุณุทูู',
                    lat: 36.1914,
                    lng: 5.4136,
                    population: 288461,
                    wilaya: 'ุณุทูู'
                },
                {
                    name: 'ุชูุงุฑุช',
                    lat: 35.3789,
                    lng: 1.3175,
                    population: 201263,
                    wilaya: 'ุชูุงุฑุช'
                },
                {
                    name: 'ุงูุจููุฑุฉ',
                    lat: 36.3763,
                    lng: 3.9000,
                    population: 68545,
                    wilaya: 'ุงูุจููุฑุฉ'
                },
                {
                    name: 'ุจุฌุงูุฉ',
                    lat: 36.7500,
                    lng: 5.0667,
                    population: 176139,
                    wilaya: 'ุจุฌุงูุฉ'
                },
                {
                    name: 'ุณูุฏู ุจูุนุจุงุณ',
                    lat: 35.2000,
                    lng: -0.6333,
                    population: 212935,
                    wilaya: 'ุณูุฏู ุจูุนุจุงุณ'
                },
                {
                    name: 'ุงูุจูุถ',
                    lat: 33.6833,
                    lng: 1.0192,
                    population: 134000,
                    wilaya: 'ุงูุจูุถ'
                },
                {
                    name: 'ุชูุฒู ูุฒู',
                    lat: 36.7167,
                    lng: 4.0500,
                    population: 135088,
                    wilaya: 'ุชูุฒู ูุฒู'
                },
                {
                    name: 'ุบุฑุฏุงูุฉ',
                    lat: 32.4833,
                    lng: 3.6667,
                    population: 120000,
                    wilaya: 'ุบุฑุฏุงูุฉ'
                },
                {
                    name: 'ูุฑููุฉ',
                    lat: 31.9500,
                    lng: 5.3167,
                    population: 133024,
                    wilaya: 'ูุฑููุฉ'
                },
                {
                    name: 'ุชููุฑุงุณุช',
                    lat: 22.7850,
                    lng: 5.5228,
                    population: 92635,
                    wilaya: 'ุชููุฑุงุณุช'
                },
                {
                    name: 'ุฃุฏุฑุงุฑ',
                    lat: 27.8744,
                    lng: -0.2936,
                    population: 68071,
                    wilaya: 'ุฃุฏุฑุงุฑ'
                },
                {
                    name: 'ุงูุดูู',
                    lat: 36.1667,
                    lng: 1.3333,
                    population: 179768,
                    wilaya: 'ุงูุดูู'
                },
                {
                    name: 'ุงููุณููุฉ',
                    lat: 35.7000,
                    lng: 4.5417,
                    population: 156647,
                    wilaya: 'ุงููุณููุฉ'
                }
            ],

            // =======================================
            // ุฅุนุฏุงุฏุงุช ุงูุฎุฑูุทุฉ
            // =======================================
            MAP: {
                // ุทุจูุงุช ุงูุฎุฑูุทุฉ ุงููุชุงุญุฉ
                TILES: {
                    OPENSTREETMAP: {
                        url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
                        attribution: 'ยฉ <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 19,
                        subdomains: ['a', 'b', 'c']
                    },
                    OPENSTREETMAP_HOT: {
                        url: 'https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png',
                        attribution: 'ยฉ OpenStreetMap contributors, Tiles style by Humanitarian OpenStreetMap Team',
                        maxZoom: 19
                    },
                    OSM_ARABIC: {
                        url: 'https://tile.openstreetmap.fr/osmfr/{z}/{x}/{y}.png',
                        attribution: 'ยฉ OpenStreetMap France',
                        maxZoom: 20
                    },
                    CARTO: {
                        url: 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png',
                        attribution: 'ยฉ OpenStreetMap contributors, ยฉ CartoDB',
                        maxZoom: 20
                    }
                },

                // ุฅุนุฏุงุฏุงุช ุนุงูุฉ
                SETTINGS: {
                    defaultTileLayer: 'OPENSTREETMAP',
                    defaultZoom: 12,
                    maxZoom: 18,
                    minZoom: 6,
                    zoomControl: true,
                    dragging: true,
                    touchZoom: true,
                    doubleClickZoom: true,
                    scrollWheelZoom: true,
                    boxZoom: true,
                    keyboard: true,
                    fadeAnimation: true,
                    zoomAnimation: true
                },

                // ุฅุนุฏุงุฏุงุช ุงูุนูุงูุงุช
                MARKERS: {
                    userIcon: {
                        html: '<div class="user-location-icon"><i class="fas fa-location-arrow"></i></div>',
                        className: 'user-location-marker',
                        iconSize: [40, 40],
                        iconAnchor: [20, 40]
                    },
                    accuracyCircle: {
                        color: '#4285f4',
                        fillColor: '#4285f4',
                        fillOpacity: 0.2,
                        weight: 2
                    },
                    businessIconSize: {
                        small: [30, 30],
                        medium: [40, 40],
                        large: [50, 50]
                    }
                }
            },

            // =======================================
            // ุฅุนุฏุงุฏุงุช ุงูุจุญุซ
            // =======================================
            SEARCH: {
                // ูุตู ูุทุฑ ุงูุจุญุซ ุจุงููููููุชุฑ
                RADIUS_OPTIONS: [
                    { value: 1, label: '1 ูู', icon: 'fas fa-walking' },
                    { value: 3, label: '3 ูู', icon: 'fas fa-bicycle' },
                    { value: 5, label: '5 ูู', icon: 'fas fa-car' },
                    { value: 10, label: '10 ูู', icon: 'fas fa-bus' },
                    { value: 20, label: '20 ูู', icon: 'fas fa-truck' },
                    { value: 50, label: '50 ูู', icon: 'fas fa-plane' }
                ],

                // ูุฆุงุช ุงูุจุญุซ
                CATEGORIES: [
                    { value: '', label: 'ุฌููุน ุงููุฆุงุช', icon: 'fas fa-list' },
                    { value: 'hospital', label: 'ูุณุชุดูู', icon: 'fas fa-hospital' },
                    { value: 'clinic', label: 'ุนูุงุฏุฉ', icon: 'fas fa-clinic-medical' },
                    { value: 'pharmacy', label: 'ุตูุฏููุฉ', icon: 'fas fa-prescription-bottle-alt' },
                    { value: 'doctor', label: 'ุทุจูุจ', icon: 'fas fa-user-md' },
                    { value: 'association', label: 'ุฌูุนูุฉ', icon: 'fas fa-hands-helping' },
                    { value: 'company', label: 'ุดุฑูุฉ', icon: 'fas fa-building' },
                    { value: 'pharmacist', label: 'ุตูุฏูู', icon: 'fas fa-mortar-pestle' }
                ],

                // ุฎูุงุฑุงุช ุงูุชุฑุชูุจ
                SORT_OPTIONS: [
                    { value: 'distance', label: 'ุงูุฃูุฑุจ ุฃููุงู', icon: 'fas fa-map-marker-alt' },
                    { value: 'rating', label: 'ุงูุฃุนูู ุชููููุงู', icon: 'fas fa-star' },
                    { value: 'name', label: 'ุงูุงุณู (ุฃ-ู)', icon: 'fas fa-sort-alpha-down' },
                    { value: 'reviewCount', label: 'ุงูุฃูุซุฑ ุชููููุงู', icon: 'fas fa-comments' }
                ],

                // ุฅุนุฏุงุฏุงุช ุงูุจุญุซ
                SETTINGS: {
                    debounceDelay: 500, // ุชุฃุฎูุฑ ุงูุจุญุซ ุงูุชููุงุฆู ุจุงููููู ุซุงููุฉ
                    minQueryLength: 2, // ุงูุญุฏ ุงูุฃุฏูู ูุทูู ุงุณุชุนูุงู ุงูุจุญุซ
                    maxResults: 50, // ุงูุญุฏ ุงูุฃูุตู ูููุชุงุฆุฌ
                    enableAutocomplete: true,
                    enableRecentSearches: true,
                    maxRecentSearches: 10,
                    searchHistoryDuration: 7 // ุฃูุงู
                }
            },

            // =======================================
            // ุฅุนุฏุงุฏุงุช ุงูุชุฎุฒูู
            // =======================================
            STORAGE: {
                KEYS: {
                    USER_LOCATION: 'user_location',
                    RECENT_SEARCHES: 'recent_searches',
                    FAVORITES: 'favorite_businesses',
                    SETTINGS: 'app_settings',
                    SEARCH_HISTORY: 'search_history'
                },

                SETTINGS: {
                    expiration: {
                        userLocation: 3600000, // ุณุงุนุฉ ูุงุญุฏุฉ ุจุงููููู ุซุงููุฉ
                        recentSearches: 604800000 // ุฃุณุจูุน ูุงุญุฏ
                    },
                    encryption: false
                }
            },

            // =======================================
            // ุฅุนุฏุงุฏุงุช ูุงุฌูุฉ ุงููุณุชุฎุฏู
            // =======================================
            UI: {
                // ุงูุฅุทุงุฑุงุช ุงูุฒูููุฉ ููุฑุณุงุฆู
                MESSAGE_TIMEOUTS: {
                    success: 3000,
                    error: 5000,
                    warning: 4000,
                    info: 3000
                },

                // ุงูุฑุณุงุฆู ุงูุงูุชุฑุงุถูุฉ
                MESSAGES: {
                    LOCATION_SUCCESS: 'ุชู ุชุญุฏูุฏ ูููุนู ุจูุฌุงุญ!',
                    LOCATION_ERROR: 'ุชุนุฐุฑ ุชุญุฏูุฏ ูููุนู. ูุฑุฌู ุงูุชุฃูุฏ ูู ุชูุนูู ุฎุฏูุฉ ุงููููุน.',
                    LOCATION_TIMEOUT: 'ุงูุชูุช ุงููููุฉ ูู ุงูุชุธุงุฑ ุงููููุน. ูุฑุฌู ุงููุญุงููุฉ ูุฑุฉ ุฃุฎุฑู.',
                    LOCATION_PERMISSION_DENIED: 'ุชู ุฑูุถ ุงูุฅุฐู ุจุงููุตูู ุฅูู ุงููููุน. ูุฑุฌู ุงูุณูุงุญ ุจุงููุตูู ุฅูู ุงููููุน ูู ุฅุนุฏุงุฏุงุช ุงููุชุตูุญ.',
                    SEARCH_NO_RESULTS: 'ูุง ุชูุฌุฏ ูุชุงุฆุฌ ููุจุญุซ. ุญุงูู ุจูููุงุช ุฃุฎุฑู ุฃู ูุณุน ูุทุงู ุงูุจุญุซ.',
                    NETWORK_ERROR: 'ุชุนุฐุฑ ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ูุฑุฌู ุงูุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช.'
                },

                // ุงูุฃููุงู
                COLORS: {
                    primary: '#4285f4',
                    secondary: '#34a853',
                    danger: '#ea4335',
                    warning: '#fbbc05',
                    info: '#17a2b8',
                    light: '#f8f9fa',
                    dark: '#343a40',
                    success: '#28a745'
                },

                // ุฃุญุฌุงู ุงูุดุงุดุงุช
                BREAKPOINTS: {
                    xs: 0,
                    sm: 576,
                    md: 768,
                    lg: 992,
                    xl: 1200,
                    xxl: 1400
                }
            },

            // =======================================
            // ุฅุนุฏุงุฏุงุช ุงูุชุทููุฑ
            // =======================================
            DEVELOPMENT: {
                logLevel: 'warn', // debug | info | warn | error
                enableMockData: true,
                mockDelay: 300, // ุชุฃุฎูุฑ ูุญุงูุงุฉ ุงูุดุจูุฉ ุจุงููููู ุซุงููุฉ
                apiCaching: true,
                cacheDuration: 300000 // 5 ุฏูุงุฆู ุจุงููููู ุซุงููุฉ
            }
        };

        // ===========================================
        // ุฏูุงู ุงููุณุงุนุฏุฉ
        // ===========================================
        CONFIG.helpers = {
            // ุงูุชุญูู ูู ุตุญุฉ ุงูููุชุงุญ
            validateApiKey: function (key) {
                return key && key.length > 20 && key !== 'YOUR_GOOGLE_API_KEY';
            },

            // ุงูุญุตูู ุนูู ุฅุญุฏุงุซูุงุช ุงููุฏููุฉ
            getCityCoordinates: function (cityName) {
                const city = CONFIG.CITIES.find(c => c.name === cityName);
                if (city) {
                    return {
                        lat: city.lat,
                        lng: city.lng,
                        name: city.name,
                        wilaya: city.wilaya
                    };
                }
                return CONFIG.LOCATION.DEFAULT;
            },

            // ุงูุจุญุซ ุนู ูุฏููุฉ ุจูุงุณุทุฉ ุฌุฒุก ูู ุงูุงุณู
            searchCities: function (query) {
                if (!query || query.length < 2) return [];
                const searchTerm = query.toLowerCase();
                return CONFIG.CITIES
                    .filter(city =>
                        city.name.toLowerCase().includes(searchTerm) ||
                        city.wilaya.toLowerCase().includes(searchTerm)
                    )
                    .slice(0, 10); // ุงูุญุฏ ุงูุฃูุตู 10 ูุชุงุฆุฌ
            },

            // ุงูุชุญูู ูู ุฃู ุงูุฅุญุฏุงุซูุงุช ุฏุงุฎู ุญุฏูุฏ ุงูุฌุฒุงุฆุฑ
            isInAlgeriaBounds: function (lat, lng) {
                const bounds = CONFIG.LOCATION.ALGERIA_BOUNDS;
                return (
                    lat >= bounds.south &&
                    lat <= bounds.north &&
                    lng >= bounds.west &&
                    lng <= bounds.east
                );
            },

            // ุงูุญุตูู ุนูู ุงููุณุงูุฉ ุจูู ูููุนูู
            calculateDistance: function (lat1, lng1, lat2, lng2) {
                const R = 6371; // ูุตู ูุทุฑ ุงูุฃุฑุถ ุจุงููููููุชุฑ
                const dLat = this.toRad(lat2 - lat1);
                const dLng = this.toRad(lng2 - lng1);
                const a =
                    Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                    Math.cos(this.toRad(lat1)) * Math.cos(this.toRad(lat2)) *
                    Math.sin(dLng / 2) * Math.sin(dLng / 2);
                const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
                return R * c;
            },

            // ุชุญููู ุงูุฏุฑุฌุงุช ุฅูู ุฑุงุฏูุงู
            toRad: function (degrees) {
                return degrees * Math.PI / 180;
            },

            // ุชูุณูู ุงููุณุงูุฉ
            formatDistance: function (distanceKm) {
                if (distanceKm < 1) {
                    return Math.round(distanceKm * 1000) + ' ูุชุฑ';
                } else if (distanceKm < 10) {
                    return distanceKm.toFixed(1) + ' ูู';
                } else {
                    return Math.round(distanceKm) + ' ูู';
                }
            },

            // ุงูุญุตูู ุนูู ุงุณู ุงููุฆุฉ
            getCategoryLabel: function (categoryValue) {
                const category = CONFIG.SEARCH.CATEGORIES.find(c => c.value === categoryValue);
                return category ? category.label : 'ุบูุฑ ูุนุฑูู';
            },

            // ุงูุญุตูู ุนูู ุฃููููุฉ ุงููุฆุฉ
            getCategoryIcon: function (categoryValue) {
                const category = CONFIG.SEARCH.CATEGORIES.find(c => c.value === categoryValue);
                return category ? category.icon : 'fas fa-map-marker-alt';
            },

            // ุงูุญุตูู ุนูู ุฎูุงุฑุงุช ูุตู ุงููุฑุถ ุจูุงุกู ุนูู ุงูููุน
            getRadiusOptionsForType: function (type = 'mobile') {
                if (type === 'mobile') {
                    return CONFIG.SEARCH.RADIUS_OPTIONS.slice(0, 4); // ุฃูู 4 ุฎูุงุฑุงุช ููุฌูุงู
                }
                return CONFIG.SEARCH.RADIUS_OPTIONS;
            }
        };

        // ===========================================
        // ุฅุถุงูุฉ ูุธุงุฆู ูููููุน ุงูุฌุบุฑุงูู
        // ===========================================
        CONFIG.location = {
            // ุงูุญุตูู ุนูู ุงููููุน ุงูุญุงูู ูููุณุชุฎุฏู
            getCurrentLocation: function (options = {}) {
                return new Promise((resolve, reject) => {
                    if (!navigator.geolocation) {
                        reject(new Error('ุงููุชุตูุญ ูุง ูุฏุนู ุฎุฏูุฉ ุชุญุฏูุฏ ุงููููุน.'));
                        return;
                    }

                    const geolocationOptions = {
                        ...CONFIG.LOCATION.GEOLOCATION,
                        ...options
                    };

                    navigator.geolocation.getCurrentPosition(
                        (position) => {
                            const location = {
                                lat: position.coords.latitude,
                                lng: position.coords.longitude,
                                accuracy: position.coords.accuracy || 50,
                                altitude: position.coords.altitude,
                                altitudeAccuracy: position.coords.altitudeAccuracy,
                                heading: position.coords.heading,
                                speed: position.coords.speed,
                                timestamp: position.timestamp
                            };

                            // ุงูุชุญูู ูู ุฃู ุงููููุน ุฏุงุฎู ุงูุฌุฒุงุฆุฑ
                            if (!CONFIG.helpers.isInAlgeriaBounds(location.lat, location.lng)) {
                                reject(new Error('ูุจุฏู ุฃูู ุฎุงุฑุฌ ุงูุฌุฒุงุฆุฑ. ุชู ุงุณุชุฎุฏุงู ุงููููุน ุงูุงูุชุฑุงุถู.'));
                                resolve(CONFIG.LOCATION.DEFAULT);
                                return;
                            }

                            // ุญูุธ ุงููููุน ูู ุงูุชุฎุฒูู ุงููุญูู
                            this.saveLocationToStorage(location);
                            resolve(location);
                        },
                        (error) => {
                            const errorMessage = this.getGeolocationError(error);
                            reject(new Error(errorMessage));
                        },
                        geolocationOptions
                    );
                });
            },

            // ุงูุญุตูู ุนูู ุฑุณุงูุฉ ุงูุฎุทุฃ ุงูููุงุณุจุฉ
            getGeolocationError: function (error) {
                switch (error.code) {
                    case error.PERMISSION_DENIED:
                        return CONFIG.UI.MESSAGES.LOCATION_PERMISSION_DENIED;
                    case error.POSITION_UNAVAILABLE:
                        return CONFIG.UI.MESSAGES.LOCATION_ERROR;
                    case error.TIMEOUT:
                        return CONFIG.UI.MESSAGES.LOCATION_TIMEOUT;
                    default:
                        return CONFIG.UI.MESSAGES.LOCATION_ERROR;
                }
            },

            // ุญูุธ ุงููููุน ูู ุงูุชุฎุฒูู ุงููุญูู
            saveLocationToStorage: function (location) {
                try {
                    const locationData = {
                        ...location,
                        savedAt: Date.now(),
                        expiresAt: Date.now() + CONFIG.STORAGE.SETTINGS.expiration.userLocation
                    };

                    localStorage.setItem(
                        CONFIG.STORAGE.KEYS.USER_LOCATION,
                        JSON.stringify(locationData)
                    );
                } catch (error) {
                    console.warn('ูุดู ุญูุธ ุงููููุน:', error);
                }
            },

            // ุงุณุชุฑุฌุงุน ุงููููุน ูู ุงูุชุฎุฒูู ุงููุญูู
            getLocationFromStorage: function () {
                try {
                    const stored = localStorage.getItem(CONFIG.STORAGE.KEYS.USER_LOCATION);
                    if (!stored) return null;

                    const location = JSON.parse(stored);

                    // ุงูุชุญูู ูู ุตูุงุญูุฉ ุงูุจูุงูุงุช
                    if (location.expiresAt && location.expiresAt > Date.now()) {
                        return location;
                    }

                    // ุงูุจูุงูุงุช ููุชููุฉ ุงูุตูุงุญูุฉ
                    localStorage.removeItem(CONFIG.STORAGE.KEYS.USER_LOCATION);
                    return null;
                } catch (error) {
                    console.warn('ูุดู ุงุณุชุฑุฌุงุน ุงููููุน:', error);
                    return null;
                }
            },

            // ุงูุญุตูู ุนูู ุฃูุฑุจ ูุฏููุฉ ูููููุน
            getNearestCity: function (lat, lng) {
                let nearestCity = null;
                let minDistance = Infinity;

                for (const city of CONFIG.CITIES) {
                    const distance = CONFIG.helpers.calculateDistance(lat, lng, city.lat, city.lng);
                    if (distance < minDistance) {
                        minDistance = distance;
                        nearestCity = city;
                    }
                }

                return nearestCity ? {
                    ...nearestCity,
                    distance: minDistance
                } : null;
            },

            // ุงูุญุตูู ุนูู ุงูุนููุงู ูู ุงูุฅุญุฏุงุซูุงุช (Geocoding)
            getAddressFromCoords: async function (lat, lng) {
                try {
                    // ูุญุงููุฉ ุงุณุชุฎุฏุงู Google Geocoding ุฃููุงู
                    if (CONFIG.helpers.validateApiKey(CONFIG.APIS.GOOGLE.key)) {
                        const url = `${CONFIG.APIS.GOOGLE.geocode}/json?latlng=${lat},${lng}&key=${CONFIG.APIS.GOOGLE.key}&language=ar`;

                        const response = await fetch(url);
                        const data = await response.json();

                        if (data.status === 'OK' && data.results.length > 0) {
                            return {
                                address: data.results[0].formatted_address,
                                provider: 'google'
                            };
                        }
                    }

                    // ุงุณุชุฎุฏุงู Nominatim ูุจุฏูู
                    const nominatimUrl = `${CONFIG.APIS.OPENSTREETMAP.nominatim}/reverse?lat=${lat}&lon=${lng}&format=json&accept-language=ar`;
                    const response = await fetch(nominatimUrl);
                    const data = await response.json();

                    if (data.display_name) {
                        return {
                            address: data.display_name,
                            provider: 'nominatim'
                        };
                    }

                    return null;
                } catch (error) {
                    console.error('ุฎุทุฃ ูู ุงูุญุตูู ุนูู ุงูุนููุงู:', error);
                    return null;
                }
            }
        };

        // ===========================================
        // ุฅุถุงูุฉ ูุธุงุฆู ููุฎุฑูุทุฉ
        // ===========================================
        CONFIG.map = {
            // ุฅูุดุงุก ุฎุฑูุทุฉ Leaflet
            createMap: function (containerId, options = {}) {
                const defaultOptions = {
                    center: CONFIG.LOCATION.DEFAULT,
                    zoom: CONFIG.MAP.SETTINGS.defaultZoom,
                    layers: [this.getTileLayer()],
                    ...CONFIG.MAP.SETTINGS,
                    ...options
                };

                return L.map(containerId, defaultOptions);
            },

            // ุงูุญุตูู ุนูู ุทุจูุฉ ุงูุฎุฑูุทุฉ
            getTileLayer: function (layerName = CONFIG.MAP.SETTINGS.defaultTileLayer) {
                const tileConfig = CONFIG.MAP.TILES[layerName] || CONFIG.MAP.TILES.OPENSTREETMAP;
                return L.tileLayer(tileConfig.url, {
                    attribution: tileConfig.attribution,
                    maxZoom: tileConfig.maxZoom,
                    subdomains: tileConfig.subdomains || ['a', 'b', 'c']
                });
            },

            // ุฅูุดุงุก ุนูุงูุฉ ูููุน ุงููุณุชุฎุฏู
            createUserMarker: function (location, options = {}) {
                const iconOptions = {
                    ...CONFIG.MAP.MARKERS.userIcon,
                    ...options.icon
                };

                const icon = L.divIcon(iconOptions);

                const marker = L.marker([location.lat, location.lng], {
                    icon: icon,
                    zIndexOffset: 1000,
                    title: 'ูููุนู ุงูุญุงูู',
                    draggable: false
                });

                // ุฅุถุงูุฉ ุฏุงุฆุฑุฉ ุงูุฏูุฉ ุฅุฐุง ูุงูุช ูุชููุฑุฉ
                if (location.accuracy) {
                    const circleOptions = {
                        ...CONFIG.MAP.MARKERS.accuracyCircle,
                        radius: location.accuracy
                    };

                    const accuracyCircle = L.circle([location.lat, location.lng], circleOptions);
                    marker.accuracyCircle = accuracyCircle;
                }

                return marker;
            },

            // ุฅูุดุงุก ุนูุงูุฉ ุงููุคุณุณุฉ
            createBusinessMarker: function (business, options = {}) {
                const iconSize = options.size || 'medium';
                const icon = L.divIcon({
                    html: `<div class="business-marker ${business.category}" title="${business.name}">
                      <i class="${CONFIG.helpers.getCategoryIcon(business.category)}"></i>
                   </div>`,
                    className: 'business-marker-icon',
                    iconSize: CONFIG.MAP.MARKERS.businessIconSize[iconSize],
                    iconAnchor: [CONFIG.MAP.MARKERS.businessIconSize[iconSize][0] / 2, CONFIG.MAP.MARKERS.businessIconSize[iconSize][1]]
                });

                return L.marker([business.lat, business.lng], {
                    icon: icon,
                    title: business.name
                });
            }
        };

        // ===========================================
        // ุงูุชุตุฏูุฑ ูุงูุชููุฆุฉ
        // ===========================================
        // ุชุณุฌูู ุงูุฅุตุฏุงุฑ
        console.log(`${CONFIG.APP.name} - ุงูุฅุตุฏุงุฑ ${CONFIG.APP.version}`);

        // ุชุตุฏูุฑ ุงูุฅุนุฏุงุฏุงุช ููุงุณุชุฎุฏุงู ุงูุนุงููู
        window.CONFIG = CONFIG;

        // ุงูุชุตุฏูุฑ ููุงุณุชุฎุฏุงู ูู ุงููุญุฏุงุช
        if (typeof module !== 'undefined' && module.exports) {
            module.exports = CONFIG;
        }

        // ุงูุชุญูู ูู ููุงุชูุญ API
        if (CONFIG.DEVELOPMENT.logLevel === 'debug') {
            console.debug('ููุชุงุญ Google API:', CONFIG.helpers.validateApiKey(CONFIG.APIS.GOOGLE.key) ? 'ุตุงูุญุฉ' : 'ุบูุฑ ุตุงูุญุฉ ุฃู ุบูุฑ ููุฌูุฏ');
        }

        // ุฅุถุงูุฉ listener ูุชูุนูู ูุถุน ุงูุธูุงู ุชููุงุฆูุงู
        if (CONFIG.UI.theme === 'auto') {
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        }
    </script>



    <script>
        class LocalStorageManager {
            static saveBusiness(business) {
                const businesses = this.getBusinesses();
                businesses.push({
                    ...business,
                    id: `local-${Date.now()}`,
                    source: 'user',
                    verified: false,
                    createdAt: new Date().toISOString()
                });
                localStorage.setItem('user_submitted_businesses', JSON.stringify(businesses));
            }

            static getBusinesses() {
                return JSON.parse(localStorage.getItem('user_submitted_businesses') || '[]');
            }
        }
    </script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            console.log('ุฌุงุฑู ุชุญููู ุงูุฎุฑูุทุฉ...');

            // ุชุญูู ูู ูุฌูุฏ ุนูุตุฑ ุงูุฎุฑูุทุฉ
            const mapElement = document.getElementById('map');
            if (!mapElement) {
                console.error('โ ุนูุตุฑ ุงูุฎุฑูุทุฉ ุบูุฑ ููุฌูุฏ ูู ุงูุตูุญุฉ');
                return;
            }

            // ุชุญูู ูู ุชุญููู Leaflet
            if (typeof L === 'undefined') {
                console.error('โ ููุชุจุฉ Leaflet ูู ุชุญูู');
                mapElement.innerHTML = '<div class="map-error">ุชุนุฐุฑ ุชุญููู ุงูุฎุฑูุทุฉ. ูุฑุฌู ุชุญุฏูุซ ุงูุตูุญุฉ.</div>';
                return;
            }

            // ุฅุญุฏุงุซูุงุช ุงูุชุฑุงุถูุฉ ููุฌุฒุงุฆุฑ
            const algeriaCenter = [36.7538, 3.0588];

            try {
                // ุฅูุดุงุก ุงูุฎุฑูุทุฉ
                window.map = L.map('map').setView(algeriaCenter, 12);

                // ุฅุถุงูุฉ ุทุจูุฉ ุงูุฎุฑูุทุฉ
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: 'ยฉ <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                    maxZoom: 19
                }).addTo(window.map);

                // ุฅุถุงูุฉ ุนูุงูุฉ ุชุฌุฑูุจูุฉ
                L.marker(algeriaCenter)
                    .addTo(window.map)
                    .bindPopup('ุงูุฌุฒุงุฆุฑ ุงูุนุงุตูุฉ<br>ูููุน ุชุฌุฑูุจู')
                    .openPopup();

                console.log('โ ุชู ุชุญููู ุงูุฎุฑูุทุฉ ุจูุฌุงุญ');

                // ุฅุถุงูุฉ ุชุญููุงุช ุจุณูุทุฉ
                setupMapControls();

            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅูุดุงุก ุงูุฎุฑูุทุฉ:', error);
                mapElement.innerHTML = `
            <div class="map-error">
                <h3>ุชุนุฐุฑ ุชุญููู ุงูุฎุฑูุทุฉ</h3>
                <p>${error.message}</p>
                <button onclick="location.reload()" class="btn btn-primary">
                    ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
                </button>
            </div>
        `;
            }
        });

        function setupMapControls() {
            // ุชูุจูุฑ
            document.getElementById('zoom-in')?.addEventListener('click', () => {
                window.map?.zoomIn();
            });

            // ุชุตุบูุฑ
            document.getElementById('zoom-out')?.addEventListener('click', () => {
                window.map?.zoomOut();
            });

            // ุชุญุฏูุฏ ุงููููุน
            document.getElementById('locate-me')?.addEventListener('click', locateUser);

            // ููุก ุงูุดุงุดุฉ
            document.getElementById('fullscreen-map')?.addEventListener('click', toggleFullscreen);
        }

        function locateUser() {
            if (!navigator.geolocation) {
                alert('ุงููุชุตูุญ ูุง ูุฏุนู ุฎุฏูุฉ ุชุญุฏูุฏ ุงููููุน');
                return;
            }

            const locateBtn = document.getElementById('locate-me');
            if (locateBtn) {
                locateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ุฌุงุฑู ุงูุชุญุฏูุฏ...';
                locateBtn.disabled = true;
            }

            navigator.geolocation.getCurrentPosition(
                function (position) {
                    const userLatLng = [position.coords.latitude, position.coords.longitude];

                    // ุฅุฒุงูุฉ ุงูุนูุงูุฉ ุงููุฏููุฉ
                    if (window.userMarker) {
                        window.map.removeLayer(window.userMarker);
                    }

                    // ุฅุถุงูุฉ ุนูุงูุฉ ุฌุฏูุฏุฉ
                    window.userMarker = L.marker(userLatLng, {
                        icon: L.divIcon({
                            html: '<div class="user-location-marker"><i class="fas fa-location-arrow"></i></div>',
                            className: 'user-location-icon'
                        })
                    }).addTo(window.map);

                    // ุงูุชูุฑูุฒ ุนูู ุงููููุน
                    window.map.setView(userLatLng, 15);

                    // ุฅุนุงุฏุฉ ุถุจุท ุงูุฒุฑ
                    if (locateBtn) {
                        locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i> ูููุนู';
                        locateBtn.disabled = false;
                    }

                    alert('ุชู ุชุญุฏูุฏ ูููุนู ุจูุฌุงุญ!');
                },
                function (error) {
                    alert('ุชุนุฐุฑ ุชุญุฏูุฏ ูููุนู. ุชุฃูุฏ ูู ุชูุนูู ุฎุฏูุฉ ุงููููุน.');

                    if (locateBtn) {
                        locateBtn.innerHTML = '<i class="fas fa-location-arrow"></i> ูููุนู';
                        locateBtn.disabled = false;
                    }
                }
            );
        }

        function toggleFullscreen() {
            const mapElement = document.getElementById('map');
            const fullscreenBtn = document.getElementById('fullscreen-map');

            if (!document.fullscreenElement) {
                if (mapElement.requestFullscreen) {
                    mapElement.requestFullscreen();
                }
                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-compress"></i>';
                }
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
                if (fullscreenBtn) {
                    fullscreenBtn.innerHTML = '<i class="fas fa-expand"></i>';
                }
            }
        }
    </script>

    <script>
        // ุฃุถู ูุฐุง ุงูููุฏ ููุชุญูู ูู ุงููุดุงูู
        document.addEventListener('DOMContentLoaded', function () {
            console.log('=== ูุญุต ุงูุฎุฑูุทุฉ ===');

            // 1. ุชุญูู ูู ูุฌูุฏ ุนูุตุฑ ุงูุฎุฑูุทุฉ
            const mapDiv = document.getElementById('map');
            console.log('ุนูุตุฑ ุงูุฎุฑูุทุฉ ููุฌูุฏุ', !!mapDiv);

            // 2. ุชุญูู ูู ุฃุจุนุงุฏ ุงูุนูุตุฑ
            if (mapDiv) {
                const rect = mapDiv.getBoundingClientRect();
                console.log('ุฃุจุนุงุฏ ุงูุฎุฑูุทุฉ:', rect.width, 'x', rect.height);
            }

            // 3. ุชุญูู ูู ููุชุจุฉ Leaflet
            console.log('ููุชุจุฉ Leaflet ูุญููุฉุ', typeof L !== 'undefined');

            // 4. ุชุญูู ูู ุงุชุตุงู ุงูุฅูุชุฑูุช
            console.log('ุงุชุตุงู ุงูุฅูุชุฑูุชุ', navigator.onLine);
        });
    </script>


    <script>
        // ุงุณุชุฎุฏุงู ูุญุฑู ุงูุจุญุซ
        document.addEventListener('DOMContentLoaded', function () {
            // ูุซุงู: ุงูุจุญุซ ุนูุฏ ุงูุถุบุท ุนูู ุฒุฑ ุงูุจุญุซ
            const searchForm = document.getElementById('search-form');
            if (searchForm) {
                searchForm.addEventListener('submit', async function (e) {
                    e.preventDefault();

                    const query = document.getElementById('main-search').value;
                    const city = document.getElementById('location-search').value;
                    const category = document.getElementById('category-select').value;
                    const radius = document.getElementById('radius-select').value;

                    // ุงูุญุตูู ุนูู ูููุน ุงููุณุชุฎุฏู ุฅุฐุง ูุงู ูุชุงุญุงู
                    let userLocation = null;
                    if (navigator.geolocation) {
                        userLocation = await new Promise(resolve => {
                            navigator.geolocation.getCurrentPosition(
                                position => resolve({
                                    lat: position.coords.latitude,
                                    lng: position.coords.longitude
                                }),
                                () => resolve(null)
                            );
                        });
                    }

                    // ุชูููุฐ ุงูุจุญุซ
                    const results = await window.searchEngine.unifiedSearch(query, {
                        city: city,
                        category: category,
                        radius: parseInt(radius),
                        userLocation: userLocation
                    });

                    // ุนุฑุถ ุงููุชุงุฆุฌ
                    displayResults(results);
                });
            }

            // ุงูุงุณุชูุงุน ููุชุงุฆุฌ ุงูุจุญุซ
            document.addEventListener('searchResults', function (event) {
                const { results, query, filters } = event.detail;
                console.log(`ุชู ุงูุนุซูุฑ ุนูู ${results.length} ูุชูุฌุฉ ููุจุญุซ: "${query}"`);
            });
        });
    </script>

</body>

</html>